<?xml version="1.0" encoding="UTF-8" ?>
<!--
    自动转换说明：
    - 原文件: SecurityAlarmHandleMapper.xml
    - 转换时间: 2026-01-19 11:04:29
    - MySQL → PostgreSQL 16.x
    
    注意事项：
    1. ON CONFLICT子句可能需要手动指定冲突列
    2. LIKE已保留，如需不区分大小写请改为ILIKE
    3. 建议人工review后再部署到生产环境
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/dtd">
<mapper namespace="com.dbapp.extension.xdr.linkageHandle.mapper.SecurityAlarmHandleMapper">

    <insert id="insertOrUpdate" parameterType="com.dbapp.extension.xdr.linkageHandle.entity.SecurityAlarmHandle">
        insert into t_security_alarm_handle
        (agg_condition, window_id,execute_time,handle_status,result)
        values
        <foreach collection="handleList" item="item" separator=",">
            (
            #{item.aggCondition,jdbcType=VARCHAR},
            #{item.windowId,jdbcType=VARCHAR},
            CAST(#{item.executeTime} AS timestamp),
            #{item.handleStatus,jdbcType=VARCHAR},
            #{item.result,jdbcType=INTEGER}
            )
        </foreach>
        ON CONFLICT DO UPDATE SET execute_time = EXCLUDED.execute_time
    </insert>

    <update id="updateStatusById" parameterType="com.dbapp.extension.xdr.linkageHandle.entity.SecurityAlarmHandle">
        UPDATE t_security_alarm_handle SET result = #{securityAlarmHandle.result,jdbcType=INTEGER} WHERE id = #{securityAlarmHandle.id}
    </update>
</mapper>