<?xml version="1.0" encoding="UTF-8" ?>
<!--
    自动转换说明：
    - 原文件: SecurityTypeMapper.xml
    - 转换时间: 2026-01-19 11:04:29
    - MySQL → PostgreSQL 16.x
    
    注意事项：
    1. ON CONFLICT子句可能需要手动指定冲突列
    2. LIKE已保留，如需不区分大小写请改为ILIKE
    3. 建议人工review后再部署到生产环境
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/dtd">
<mapper namespace="com.dbapp.extension.xdr.threatMonitor.mapper.SecurityTypeMapper">


	<resultMap id="baseResultMap" type="com.dbapp.extension.xdr.threatMonitor.entity.SecurityType">
		<result column="sub_category" property="subCategory" jdbcType="VARCHAR"/>
		<result column="category" property="category" jdbcType="VARCHAR"/>
	</resultMap>
	<select id="queryTypes" resultMap="baseResultMap" >
	SELECT
	DISTINCT incident_sub_class_type as sub_category,
	incident_class_type as category
	FROM
	t_event_template
	</select>

	<select id="truncate">
 		truncate table t_security_types
	</select>

	<insert id="branchInsert" parameterType="com.dbapp.extension.xdr.threatMonitor.entity.SecurityType" keyProperty="id" useGeneratedKeys="true">
			INSERT INTO t_security_types (mirror_sub_category,mirror_category,sub_category_name,category_name,is_enable)
			values
		<foreach collection="list" item="securityTypes" separator=",">
			(#{securityTypes.mirrorSubCategory,jdbcType=VARCHAR},#{securityTypes.mirrorCategory,jdbcType=VARCHAR},
			#{securityTypes.subCategoryName,jdbcType=VARCHAR},#{securityTypes.categoryName,jdbcType=VARCHAR},#{securityTypes.isEnable,jdbcType=INTEGER})
		</foreach>
		ON CONFLICT DO UPDATE SET mirror_sub_category = EXCLUDED.mirror_sub_category,mirror_category = EXCLUDED.mirror_category,
		sub_category_name = EXCLUDED.sub_category_name , category_name = EXCLUDED.category_name
	</insert>
</mapper>