# DDLå’ŒXMLé—®é¢˜æ±‡æ€»æŠ¥å‘Š

## ğŸ“‹ å‘ç°çš„é—®é¢˜

æ ¹æ®æ£€æŸ¥ï¼Œå…±å‘ç°ä»¥ä¸‹é—®é¢˜éœ€è¦å¤„ç†ï¼š

---

## ğŸ”´ é—®é¢˜1: DDLæ–‡ä»¶ä¸­å­˜åœ¨ `xdr22.` æ¨¡å¼åå‰ç¼€

### å½±å“èŒƒå›´
- **å½±å“æ–‡ä»¶æ•°**: 53ä¸ªDDLæ–‡ä»¶
- **æ€»å‡ºç°æ¬¡æ•°**: 62å¤„

### é—®é¢˜ç¤ºä¾‹

**æ–‡ä»¶**: `V20260122133659038__create_t_scan_history.sql`

```sql
-- âŒ é”™è¯¯ï¼ˆç¬¬88-90è¡Œï¼‰
"virus_status" "t_scan_history_virus_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::xdr22.t_scan_history_virus_status,
"site_status" "t_scan_history_site_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::xdr22.t_scan_history_site_status,
"vulnerability_status" "t_scan_history_vulnerability_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::xdr22.t_scan_history_vulnerability_status,
```

### é—®é¢˜è¯´æ˜
- ä½¿ç”¨äº† `xdr22.` ä½œä¸ºæ¨¡å¼åå‰ç¼€
- ä½†å®é™…PostgreSQLæ•°æ®åº“å¯èƒ½ä¸ä½¿ç”¨è¿™ä¸ªæ¨¡å¼å
- éœ€è¦å…¨éƒ¨åˆ é™¤ `xdr22.` å‰ç¼€

### ä¿®å¤æ–¹æ¡ˆ
```sql
-- âœ… ä¿®å¤å
"virus_status" "t_scan_history_virus_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::t_scan_history_virus_status,
"site_status" "t_scan_history_site_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::t_scan_history_site_status,
"vulnerability_status" "t_scan_history_vulnerability_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::t_scan_history_vulnerability_status,
```

### å½±å“çš„è¡¨ç±»å‹
ä¸»è¦æ˜¯è‡ªå®šä¹‰æšä¸¾ç±»å‹ï¼ˆENUMï¼‰çš„DEFAULTå€¼

---

## ğŸ”´ é—®é¢˜2: XMLä¸­BOOLEANå­—æ®µä½¿ç”¨INTEGERç±»å‹

### 2.1 SecurityTypeMapper.xml - is_enableå­—æ®µ

**æ–‡ä»¶**: `postgresql_xml_manual/SecurityTypeMapper.xml`

**DDLå®šä¹‰** (`V20260122133659048__create_t_security_types.sql`):
```sql
"is_enable" bool NOT NULL DEFAULT false
```

**XMLå½“å‰å†™æ³•** (ç¬¬27-31è¡Œ):
```xml
<!-- âŒ é”™è¯¯ -->
<insert id="branchInsert">
    INSERT INTO t_security_types (..., "is_enable")
    VALUES
    <foreach collection="list" item="securityTypes" separator=",">
        (..., #{securityTypes.isEnable,jdbcType=INTEGER})
    </foreach>
</insert>
```

**ä¿®å¤æ–¹æ¡ˆ**:
```xml
<!-- âœ… ä¿®å¤å -->
<insert id="branchInsert">
    INSERT INTO t_security_types (..., "is_enable")
    VALUES
    <foreach collection="list" item="securityTypes" separator=",">
        (..., (#{securityTypes.isEnable,jdbcType=INTEGER}::int)::boolean)
    </foreach>
</insert>
```

---

### 2.2 EventTemplateMapper.xml - enableå­—æ®µ

**æ–‡ä»¶**: `postgresql_xml_manual/EventTemplateMapper.xml`

**DDLå®šä¹‰** (`V20260122133659014__create_t_event_template.sql`):
```sql
"enable" bool NOT NULL DEFAULT false
```

**å½“å‰çŠ¶æ€**: âš ï¸ å·²ç»ä¿®å¤è¿‡ä¸€æ¬¡ï¼Œä½†éœ€è¦ç¡®è®¤

**éœ€è¦æ£€æŸ¥çš„åœ°æ–¹**:
1. `batchInsert` - enableå­—æ®µ
2. `updateByUniqCode` - enableå­—æ®µ
3. `updateByIncidentName` - enableå­—æ®µ

**æœŸæœ›æ ¼å¼**:
```xml
(#{eventList.enable,jdbcType=INTEGER}::int)::boolean
```

---

### 2.3 SecurityAlarmHandleMapper.xml - resultå­—æ®µ

**æ–‡ä»¶**: `postgresql_xml_manual/SecurityAlarmHandleMapper.xml`

**DDLå®šä¹‰** (`V20260122133659045__create_t_security_alarm_handle.sql`):
```sql
"result" bool
```

**XMLå½“å‰å†™æ³•** (ç¬¬19è¡Œ, ç¬¬26è¡Œ):
```xml
<!-- âŒ é”™è¯¯ -->
<!-- insertOrUpdateä¸­ -->
#{item.result,jdbcType=INTEGER}

<!-- updateStatusByIdä¸­ -->
#{securityAlarmHandle.result,jdbcType=INTEGER}
```

**ä¿®å¤æ–¹æ¡ˆ**:
```xml
<!-- âœ… ä¿®å¤å -->
<!-- insertOrUpdateä¸­ -->
(#{item.result,jdbcType=INTEGER}::int)::boolean

<!-- updateStatusByIdä¸­ -->
(#{securityAlarmHandle.result,jdbcType=INTEGER}::int)::boolean
```

---

## ğŸ“Š é—®é¢˜ç»Ÿè®¡

| é—®é¢˜ç±»å‹ | å½±å“æ–‡ä»¶æ•° | å½±å“å¤„æ•° | ä¼˜å…ˆçº§ |
|---------|-----------|---------|--------|
| **1. xdr22.æ¨¡å¼åå‰ç¼€** | 53ä¸ªDDL | 62å¤„ | ğŸ”´ é«˜ |
| **2. BOOLEAN vs INTEGER** | 3ä¸ªXML | 5å¤„ | ğŸ”´ é«˜ |
| **æ€»è®¡** | **56ä¸ªæ–‡ä»¶** | **67å¤„** | - |

---

## ğŸ“ è¯¦ç»†é—®é¢˜æ¸…å•

### é—®é¢˜1è¯¦æƒ…: xdr22.æ¨¡å¼åå‰ç¼€ (62å¤„)

æ‰€æœ‰53ä¸ªDDLæ–‡ä»¶éƒ½åŒ…å«è‡³å°‘1å¤„ `xdr22.` å‰ç¼€ï¼Œä¸»è¦å‡ºç°åœ¨ï¼š
- è‡ªå®šä¹‰ç±»å‹çš„ç±»å‹è½¬æ¢: `::xdr22.type_name`
- é»˜è®¤å€¼å®šä¹‰: `DEFAULT 'value'::xdr22.type_name`

**éœ€è¦æ‰¹é‡æ›¿æ¢**: `xdr22.` â†’ `` (ç©ºå­—ç¬¦ä¸²)

---

### é—®é¢˜2è¯¦æƒ…: BOOLEAN vs INTEGER (5å¤„)

| åºå· | XMLæ–‡ä»¶ | insert/update id | è¡¨å | å­—æ®µ | ä½ç½® |
|------|---------|-----------------|------|------|------|
| 1 | SecurityTypeMapper.xml | branchInsert | t_security_types | is_enable | ç¬¬31è¡Œ |
| 2 | EventTemplateMapper.xml | batchInsert | t_event_template | enable | éœ€ç¡®è®¤ |
| 3 | EventTemplateMapper.xml | updateByUniqCode | t_event_template | enable | éœ€ç¡®è®¤ |
| 4 | SecurityAlarmHandleMapper.xml | insertOrUpdate | t_security_alarm_handle | result | ç¬¬19è¡Œ |
| 5 | SecurityAlarmHandleMapper.xml | updateStatusById | t_security_alarm_handle | result | ç¬¬26è¡Œ |

---

## ğŸ”§ ä¿®å¤å»ºè®®

### ä¿®å¤é¡ºåº

1. âœ… **å…ˆä¿®å¤é—®é¢˜1** (xdr22.æ¨¡å¼å) - æ‰¹é‡æ›¿æ¢ï¼Œå½±å“èŒƒå›´å¤§
2. âœ… **å†ä¿®å¤é—®é¢˜2** (BOOLEANè½¬æ¢) - é€ä¸ªæ£€æŸ¥ä¿®å¤

### ä¿®å¤æ–¹æ³•

#### é—®é¢˜1: æ‰¹é‡æ›¿æ¢xdr22.
```python
# ä½¿ç”¨è„šæœ¬æ‰¹é‡æ›¿æ¢
pattern = r'xdr22\.'
replacement = ''
```

#### é—®é¢˜2: BOOLEANå­—æ®µè½¬æ¢
```xml
<!-- ç»Ÿä¸€æ ¼å¼ -->
(#{field,jdbcType=INTEGER}::int)::boolean
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### EventTemplateMapper.xml
è¯¥æ–‡ä»¶ä¹‹å‰å·²ç»ä¿®å¤è¿‡ `enable` å­—æ®µï¼Œä½†æ£€æµ‹å·¥å…·ä»ç„¶æŠ¥é”™ã€‚
éœ€è¦äººå·¥ç¡®è®¤å½“å‰çŠ¶æ€ï¼š
- å¦‚æœå·²ç»ä½¿ç”¨ `(#{field}::int)::boolean` æ ¼å¼ â†’ æ— éœ€ä¿®å¤
- å¦‚æœä»ç„¶æ˜¯ `#{field,jdbcType=INTEGER}` â†’ éœ€è¦ä¿®å¤

### SecurityAlarmHandleMapper.xml
è¯¥æ–‡ä»¶æœ‰2å¤„éœ€è¦ä¿®å¤ï¼š
1. `insertOrUpdate` ä¸­çš„ `result` å­—æ®µ
2. `updateStatusById` ä¸­çš„ `result` å­—æ®µ

---

## ğŸ¯ ä¿®å¤åçš„éªŒè¯

### éªŒè¯DDLä¿®å¤
```bash
# éªŒè¯ xdr22. å·²å…¨éƒ¨åˆ é™¤
grep -r "xdr22\." create_table/migrations_ultimate/
# åº”è¯¥è¿”å›: æ— åŒ¹é…
```

### éªŒè¯XMLä¿®å¤
1. æ£€æŸ¥æ‰€æœ‰BOOLEANå­—æ®µæ˜¯å¦ä½¿ç”¨äº†ç±»å‹è½¬æ¢
2. æ‰§è¡ŒSQLç¡®è®¤æ•°æ®æ’å…¥æˆåŠŸ
3. ä½¿ç”¨Postmanæµ‹è¯•æ¥å£

---

## ğŸ“‹ å¾…ç¡®è®¤äº‹é¡¹

### éœ€è¦ç”¨æˆ·ç¡®è®¤ï¼š

1. âœ… **EventTemplateMapper.xml** 
   - å½“å‰ `enable` å­—æ®µæ˜¯å¦å·²ç»ä¿®å¤ï¼Ÿ
   - å¦‚æœå·²ä¿®å¤ï¼Œæ˜¯ä»€ä¹ˆæ ¼å¼ï¼Ÿ

2. âœ… **æ˜¯å¦è¿˜æœ‰å…¶ä»–BOOLEANå­—æ®µ**
   - é™¤äº†æ£€æµ‹åˆ°çš„3ä¸ªå­—æ®µå¤–
   - æ˜¯å¦è¿˜æœ‰å…¶ä»–åœ°æ–¹éœ€è¦ä¿®å¤ï¼Ÿ

3. âœ… **xdr22æ¨¡å¼å**
   - ç¡®è®¤PostgreSQLæ•°æ®åº“ä¸ä½¿ç”¨ `xdr22` æ¨¡å¼ï¼Ÿ
   - è¿˜æ˜¯åº”è¯¥æ”¹ä¸ºå…¶ä»–æ¨¡å¼åï¼ˆå¦‚ `public`ï¼‰ï¼Ÿ

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-22  
**æ£€æŸ¥æ–‡ä»¶æ•°**: 93ä¸ª (53ä¸ªDDL + 40ä¸ªXML)  
**å‘ç°é—®é¢˜æ•°**: 67å¤„  
**çŠ¶æ€**: â³ ç­‰å¾…ç”¨æˆ·ç¡®è®¤
