package com.test.controller;

import com.dbapp.extension.xdr.linkageHandle.mapper.LinkedStrategyMapper;
import com.dbapp.extension.xdr.linkageHandle.entity.LinkedStrategy;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.*;

/**
 * LinkedStrategy 测试 Controller
 * 
 * 所有测试方法使用 GET 请求，参数在方法内部写死
 * 通过 Postman 调用 http://localhost:8080/test/linkedStrategy/testX_methodName
 * 
 * 测试数据：使用test_data.sql中的测试数据
 * 
 * 生成时间: 2026-01-26
 */
@RestController
@RequestMapping("/test/linkedStrategy")
public class LinkedStrategyTestController {
    
    @Autowired
    private LinkedStrategyMapper mapper;

    /**
     * 测试1：插入或更新
     * URL: /test/linkedStrategy/insertOrUpdate
     */
    @GetMapping("/insertOrUpdate")
    public String testInsertOrUpdate() {
        System.out.println("测试: insertOrUpdate");
        
        LinkedStrategy strategy = new LinkedStrategy();
        strategy.setStrategyName("测试联动策略-001");
        strategy.setDeviceType("firewall");
        strategy.setStatus(1);
        strategy.setIsEnable(true);
        strategy.setPriority(10);
        
        int rows = mapper.insertOrUpdate(strategy);
        System.out.println("结果: 影响 " + rows + " 行，ID=" + strategy.getId());
        return "SUCCESS: " + rows + " 条";
    }

    /**
     * 测试2：启用策略
     * URL: /test/linkedStrategy/enableLinkStrategy
     */
    @GetMapping("/enableLinkStrategy")
    public String testEnableLinkStrategy() {
        System.out.println("测试: enableLinkStrategy");
        
        LinkedStrategy strategy = new LinkedStrategy();
        strategy.setId(2001L); // 使用test_data.sql中的数据
        strategy.setIsEnable(true);
        
        mapper.enableLinkStrategy(strategy);
        System.out.println("启用成功");
        return "SUCCESS: 启用策略 2001";
    }

    /**
     * 测试3：更新策略
     * URL: /test/linkedStrategy/update
     */
    @GetMapping("/update")
    public String testUpdate() {
        System.out.println("测试: update");
        
        LinkedStrategy strategy = new LinkedStrategy();
        strategy.setId(2001L);
        strategy.setStrategyName("更新后的策略名称");
        strategy.setPriority(20);
        
        mapper.update(strategy);
        System.out.println("更新成功");
        return "SUCCESS: 更新策略 2001";
    }

    /**
     * 测试4：删除策略
     * URL: /test/linkedStrategy/deleteLinkStrategy
     */
    @GetMapping("/deleteLinkStrategy")
    public String testDeleteLinkStrategy() {
        System.out.println("测试: deleteLinkStrategy");
        
        int rows = mapper.deleteLinkStrategy(2005L); // 使用test_data.sql中的数据
        System.out.println("结果: 删除 " + rows + " 条");
        return "SUCCESS: 删除 " + rows + " 条";
    }

    /**
     * 测试5：根据ID获取策略
     * URL: /test/linkedStrategy/getLinkStrategyById
     */
    @GetMapping("/getLinkStrategyById")
    public String testGetLinkStrategyById() {
        System.out.println("测试: getLinkStrategyById");
        
        LinkedStrategy result = mapper.getLinkStrategyById(2001L);
        if (result != null) {
            System.out.println("结果: " + result.getStrategyName());
            return "SUCCESS: " + result.getStrategyName();
        } else {
            return "未找到数据";
        }
    }

    /**
     * 测试6：根据ID列表获取策略
     * URL: /test/linkedStrategy/getLinkStrategyByIds
     */
    @GetMapping("/getLinkStrategyByIds")
    public String testGetLinkStrategyByIds() {
        System.out.println("测试: getLinkStrategyByIds");
        
        List<Long> ids = Arrays.asList(2001L, 2002L, 2003L);
        List<LinkedStrategy> result = mapper.getLinkStrategyByIds(ids);
        System.out.println("结果: 查询到 " + result.size() + " 条");
        return "SUCCESS: " + result.size() + " 条";
    }

    /**
     * 测试7：获取列表总数
     * URL: /test/linkedStrategy/getLinkStrategyListTotal
     */
    @GetMapping("/getLinkStrategyListTotal")
    public String testGetLinkStrategyListTotal() {
        System.out.println("测试: getLinkStrategyListTotal");
        
        Map<String, Object> params = new HashMap<>();
        params.put("isEnable", true);
        
        Long count = mapper.getLinkStrategyListTotal(params);
        System.out.println("结果: 共 " + count + " 条");
        return "SUCCESS: " + count + " 条";
    }

    /**
     * 测试8：获取列表
     * URL: /test/linkedStrategy/getLinkStrategyList
     */
    @GetMapping("/getLinkStrategyList")
    public String testGetLinkStrategyList() {
        System.out.println("测试: getLinkStrategyList");
        
        Map<String, Object> params = new HashMap<>();
        params.put("offset", 0);
        params.put("limit", 10);
        
        List<LinkedStrategy> result = mapper.getLinkStrategyList(params);
        System.out.println("结果: 查询到 " + result.size() + " 条");
        return "SUCCESS: " + result.size() + " 条";
    }

    /**
     * 测试9：根据名称和ID获取数量
     * URL: /test/linkedStrategy/getLinkStrategyCountByNameAndId
     */
    @GetMapping("/getLinkStrategyCountByNameAndId")
    public String testGetLinkStrategyCountByNameAndId() {
        System.out.println("测试: getLinkStrategyCountByNameAndId");
        
        Integer count = mapper.getLinkStrategyCountByNameAndId("DDoS防护策略", 2001L);
        System.out.println("结果: 共 " + count + " 条");
        return "SUCCESS: " + count + " 条";
    }

    /**
     * 测试10：根据参数查找策略
     * URL: /test/linkedStrategy/findLinkStrategyByParam
     */
    @GetMapping("/findLinkStrategyByParam")
    public String testFindLinkStrategyByParam() {
        System.out.println("测试: findLinkStrategyByParam");
        
        Map<String, Object> params = new HashMap<>();
        params.put("deviceType", "firewall");
        params.put("status", 1);
        
        List<LinkedStrategy> result = mapper.findLinkStrategyByParam(params);
        System.out.println("结果: 查询到 " + result.size() + " 条");
        return "SUCCESS: " + result.size() + " 条";
    }

    /**
     * 测试11：获取所有模板策略ID
     * URL: /test/linkedStrategy/getAllTemplateStrategyIds
     */
    @GetMapping("/getAllTemplateStrategyIds")
    public String testGetAllTemplateStrategyIds() {
        System.out.println("测试: getAllTemplateStrategyIds");
        
        List<LinkedStrategy> result = mapper.getAllTemplateStrategyIds();
        System.out.println("结果: 查询到 " + result.size() + " 个模板策略");
        return "SUCCESS: " + result.size() + " 个模板策略";
    }

    /**
     * 测试12：批量更新联动设备配置
     * URL: /test/linkedStrategy/batchUpdateLinkDeviceConfig
     */
    @GetMapping("/batchUpdateLinkDeviceConfig")
    public String testBatchUpdateLinkDeviceConfig() {
        System.out.println("测试: batchUpdateLinkDeviceConfig");
        
        LinkedStrategy strategy = new LinkedStrategy();
        strategy.setThirdAuthId(100L);
        
        mapper.batchUpdateLinkDeviceConfig(strategy);
        System.out.println("更新成功");
        return "SUCCESS: 批量更新完成";
    }

    /**
     * 测试13：获取所有策略
     * URL: /test/linkedStrategy/getAllStrategys
     */
    @GetMapping("/getAllStrategys")
    public String testGetAllStrategys() {
        System.out.println("测试: getAllStrategys");
        
        List<LinkedStrategy> result = mapper.getAllStrategys();
        System.out.println("结果: 查询到 " + result.size() + " 条");
        return "SUCCESS: " + result.size() + " 条";
    }

    /**
     * 测试14：更新AppId
     * URL: /test/linkedStrategy/updateAppId
     */
    @GetMapping("/updateAppId")
    public String testUpdateAppId() {
        System.out.println("测试: updateAppId");
        
        LinkedStrategy strategy = new LinkedStrategy();
        strategy.setId(2001L);
        strategy.setAppId("APP-12345");
        
        mapper.updateAppId(strategy);
        System.out.println("更新成功");
        return "SUCCESS: 更新AppId完成";
    }
}
