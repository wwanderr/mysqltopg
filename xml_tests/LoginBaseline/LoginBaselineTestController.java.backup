package com.test.controller;

import com.dbapp.extension.xdr.threatAnalysis.mapper.LoginBaselineMapper;
import com.dbapp.extension.xdr.threatAnalysis.entity.LoginBaseline;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.List;

/**
 * LoginBaseline 测试 Controller
 * 
 * 所有测试方法使用 GET 请求，参数在方法内部写死
 * 通过 Postman 调用 http://localhost:8080/test/loginBaseline/testX_methodName
 * 
 * 生成时间: 2026-01-26
 */
@RestController
@RequestMapping("/test/loginBaseline")
public class LoginBaselineTestController {
    @Autowired
    private LoginBaselineMapper mapper;

    /**
     * 测试1：清理超时数据
     * URL: /test/loginBaseline/cleanOvertimeData
     */
    @GetMapping("/cleanOvertimeData")
    public String testCleanOvertimeData() {
        System.out.println("测试: cleanOvertimeData");
        int rows = mapper.cleanOvertimeData(720); // 清理30天前的数据
        System.out.println("结果: 清理 " + rows + " 条");
        return "SUCCESS: 清理 " + rows + " 条";
    }

    /**
     * 测试2：插入或更新
     * URL: /test/loginBaseline/insertOrUpdate
     */
    @GetMapping("/insertOrUpdate")
    public String testInsertOrUpdate() {
        System.out.println("测试: insertOrUpdate");
        
        List<LoginBaseline> list = new ArrayList<>();
        LoginBaseline baseline = new LoginBaseline();
        baseline.setAssetIp("192.168.1.100");
        baseline.setUserName("test-user");
        baseline.setServiceType("ssh");
        baseline.setLoginCount(10);
        list.add(baseline);
        
        int rows = mapper.insertOrUpdate(list);
        System.out.println("结果: 影响 " + rows + " 行");
        return "SUCCESS: " + rows + " 条";
    }

    /**
     * 测试3：根据主键查询
     * URL: /test/loginBaseline/queryByPrimaryKey
     */
    @GetMapping("/queryByPrimaryKey")
    public String testQueryByPrimaryKey() {
        System.out.println("测试: queryByPrimaryKey");
        LoginBaseline result = mapper.queryByPrimaryKey("192.168.1.100", "admin", "ssh");
        if (result != null) {
            System.out.println("结果: " + result.getAssetIp() + " - " + result.getUserName());
            return "SUCCESS: 查询到数据";
        } else {
            return "未找到数据";
        }
    }
}
