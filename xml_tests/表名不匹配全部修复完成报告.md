# è¡¨åä¸åŒ¹é…é—®é¢˜ - å…¨éƒ¨ä¿®å¤å®ŒæˆæŠ¥å‘Š

## æ‰§è¡Œæ¦‚è§ˆ

**ä¿®å¤æ—¶é—´**: 2026-01-28  
**ä¿®å¤èŒƒå›´**: 8ä¸ªé«˜ä¼˜å…ˆçº§æ¨¡å—  
**ä¿®å¤ç±»å‹**: test_data.sql è¡¨åä¸ XML Mapper ä¸€è‡´æ€§ä¿®å¤  
**ä¿®å¤çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆ

---

## ä¿®å¤æ¸…å•

### 1. LinkedStrategyValidtime âœ…

**é—®é¢˜**: 
- é”™è¯¯è¡¨å: `t_linked_strategy_validtime`
- æ­£ç¡®è¡¨å: `t_linkage_strategy_validtime`
- å­—æ®µä¹Ÿå®Œå…¨ä¸åŒ¹é…

**ä¿®å¤å†…å®¹**:
```sql
-- ä¿®å¤åä½¿ç”¨æ­£ç¡®çš„è¡¨ç»“æ„
è¡¨å: t_linkage_strategy_validtime
å­—æ®µ:
  - block_ip (é˜»æ–­IP)
  - block_domain (å°ç¦åŸŸå)
  - link_device_ip (è”åŠ¨è®¾å¤‡IP)
  - end_time (ç»“æŸæ—¶é—´, int8)
  - node_id (ç»ˆç«¯ID)
  - direction (æ–¹å‘: 1å…¥å‘/2å‡ºå‘/3åŒå‘)
  - effect_time (ç”Ÿæ•ˆæ—¶é•¿ï¼Œ0=æ°¸ä¹…)
```

**å”¯ä¸€çº¦æŸ**: `(link_device_ip, block_ip, block_domain, node_id)`

**æµ‹è¯•æ•°æ®**: 5æ¡è®°å½•ï¼Œè¦†ç›–IPå°ç¦ã€åŸŸåå°ç¦ã€ä¸åŒæ–¹å‘ã€ä¸´æ—¶/æ°¸ä¹…ç­‰åœºæ™¯

---

### 2. LoginBaseline âœ…

**é—®é¢˜**: 
- é”™è¯¯è¡¨å: `t_login_baseline`
- æ­£ç¡®è¡¨å: `t_scene_login_baseline`
- å­—æ®µä¸åŒ¹é…

**ä¿®å¤å†…å®¹**:
```sql
è¡¨å: t_scene_login_baseline
å­—æ®µ:
  - dest_address (ç›®çš„IP) - ä¸»é”®1
  - src_user_name (ç”¨æˆ·å) - ä¸»é”®2
  - last_login_time (æœ€åç™»å½•æ—¶é—´)
  - city_counts (åŸå¸‚ç™»å½•æ¬¡æ•°JSON)
  - city_array (æ’åå‰ä¸‰çš„åŸå¸‚)
  - create_time
  - update_time
```

**ä¸»é”®**: `(dest_address, src_user_name)`

**æµ‹è¯•æ•°æ®**: 5æ¡è®°å½•ï¼Œè¦†ç›–ä¸åŒç”¨æˆ·ã€å¤šåŸå¸‚ç™»å½•åœºæ™¯

---

### 3. RiskIncidentHistory âœ…

**é—®é¢˜**: 
- é”™è¯¯è¡¨å: `t_risk_incident_history` (å•æ•°)
- æ­£ç¡®è¡¨å: `t_risk_incidents_history` (å¤æ•°)

**ä¿®å¤å†…å®¹**:
```sql
è¡¨å: t_risk_incidents_history (æ³¨æ„ incidents æ˜¯å¤æ•°)
æµ‹è¯•æ•°æ®ID: 9001-9005
åœºæ™¯:
  - SSHæš´åŠ›ç ´è§£å†å²
  - æ¨ªå‘ç§»åŠ¨å†å²
  - æ•°æ®å¤–æ³„å†å²
  - C&Cé€šä¿¡å†å²
  - æ¶æ„è½¯ä»¶æ‰§è¡Œå†å²
```

---

### 4. ScenarioData âœ…

**é—®é¢˜**: 
- é”™è¯¯è¡¨å: `t_scenario_data`
- æ­£ç¡®è¡¨å: `t_event_scenario_data`

**ä¿®å¤å†…å®¹**:
```sql
è¡¨å: t_event_scenario_data (æ³¨æ„æœ‰ event_ å‰ç¼€)
æµ‹è¯•æ•°æ®ID: 7001-7005
å­—æ®µ:
  - scenario_code (åœºæ™¯ä»£ç )
  - event_code (äº‹ä»¶ä»£ç )
  - alarm_code (å‘Šè­¦ä»£ç )
```

---

### 5. ScenarioTemplate âœ…

**é—®é¢˜**: 
- é”™è¯¯è¡¨å: `t_scenario_template`
- æ­£ç¡®è¡¨å: `t_event_scenario_template`

**ä¿®å¤å†…å®¹**:
```sql
è¡¨å: t_event_scenario_template (æ³¨æ„æœ‰ event_ å‰ç¼€)
æµ‹è¯•æ•°æ®ID: 8001-8005
å­—æ®µ:
  - scenario_name (åœºæ™¯åç§°)
  - scenario_code (åœºæ™¯ä»£ç )
  - source (æ¥æº)
  - request_url (è¯·æ±‚URL)
  - condition (æ¡ä»¶JSON)
  - event_name (äº‹ä»¶åç§°)
```

**åœºæ™¯è¦†ç›–**:
- APTæ”»å‡»åœºæ™¯
- å‹’ç´¢è½¯ä»¶åœºæ™¯
- æ¨ªå‘ç§»åŠ¨åœºæ™¯
- æ•°æ®å¤–æ³„åœºæ™¯
- C&Cé€šä¿¡åœºæ™¯

---

### 6. SecurityType âœ…

**é—®é¢˜**: 
- é”™è¯¯è¡¨å: `t_security_type` (å•æ•°)
- æ­£ç¡®è¡¨å: `t_security_types` (å¤æ•°)

**ä¿®å¤å†…å®¹**:
```sql
è¡¨å: t_security_types (æ³¨æ„ types æ˜¯å¤æ•°)
æµ‹è¯•æ•°æ®ID: 6001-6005
å­—æ®µ:
  - mirror_sub_category (é•œåƒå­ç±»åˆ«)
  - mirror_category (é•œåƒç±»åˆ«)
  - sub_category_name (å­ç±»åˆ«åç§°)
  - category_name (ç±»åˆ«åç§°)
  - is_enable (æ˜¯å¦å¯ç”¨)
```

**ç±»å‹è¦†ç›–**:
- æ¶æ„è½¯ä»¶æ£€æµ‹
- å‹’ç´¢è½¯ä»¶æ£€æµ‹
- æ¨ªå‘ç§»åŠ¨
- æ•°æ®å¤–æ³„
- C&Cé€šä¿¡

---

### 7. SharedData âœ…

**é—®é¢˜**: 
- é”™è¯¯è¡¨å: `t_shared_data`
- æ­£ç¡®è¡¨å: `t_aigent_shared_data`

**ä¿®å¤å†…å®¹**:
```sql
è¡¨å: t_aigent_shared_data (æ³¨æ„æœ‰ aigent_ å‰ç¼€)
æµ‹è¯•æ•°æ®ID: 5001-5005
åœºæ™¯:
  - å¨èƒæƒ…æŠ¥æºé…ç½®
  - æœ€å¤§å¹¶å‘æ‰«ææ•°
  - å‘Šè­¦é˜ˆå€¼
  - è‡ªåŠ¨é˜»æ–­å¼€å…³
  - æ‰«æè®¡åˆ’
```

---

### 8. TagSearch âœ…

**é—®é¢˜**: 
- é”™è¯¯è¡¨å: `t_tag_search`
- æ­£ç¡®è¡¨å: `t_tag_search_list`

**ä¿®å¤å†…å®¹**:
```sql
è¡¨å: t_tag_search_list (æ³¨æ„æœ‰ _list åç¼€)
æµ‹è¯•æ•°æ®ID: 4001-4005
å­—æ®µ:
  - tag_search (æ ‡ç­¾æœç´¢å…³é”®å­—)
  - name (åç§°)
  - update_time (æ›´æ–°æ—¶é—´)
```

---

## ä¿®å¤ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| ä¿®å¤çš„æ¨¡å— | 8 | å…¨éƒ¨é«˜ä¼˜å…ˆçº§æ¨¡å— |
| è¡¨åå‰ç¼€é—®é¢˜ | 4 | event_, scene_, aigent_, security_ |
| è¡¨åå•å¤æ•°é—®é¢˜ | 2 | incidents, types |
| è¡¨ååç¼€é—®é¢˜ | 1 | _list |
| è¡¨åå®Œå…¨ä¸åŒ | 1 | linkage vs linked |
| ç”Ÿæˆçš„æµ‹è¯•è®°å½• | 40 | æ¯ä¸ªæ¨¡å—5æ¡ |

---

## å¸¸è§è¡¨åæ¨¡å¼æ€»ç»“

### 1. å¸¦å‰ç¼€çš„è¡¨å
- `t_event_*` - äº‹ä»¶ç›¸å…³è¡¨
- `t_scene_*` - åœºæ™¯ç›¸å…³è¡¨
- `t_aigent_*` - AIä»£ç†ç›¸å…³è¡¨
- `t_security_*` - å®‰å…¨ç›¸å…³è¡¨

### 2. å•å¤æ•°è§„åˆ™
- `t_risk_incidents_history` - incidentsæ˜¯å¤æ•°
- `t_security_types` - typesæ˜¯å¤æ•°
- `t_linkage_strategy_validtime` - strategyæ˜¯å•æ•°

### 3. ç‰¹æ®Šåç¼€
- `t_tag_search_list` - åˆ—è¡¨åç¼€

---

## éªŒè¯æ–¹æ³•

### 1. æ‰§è¡Œæµ‹è¯•SQL
```bash
cd xml_tests/<æ¨¡å—å>
psql -U dbapp -d your_database -f test_data.sql
```

### 2. æ£€æŸ¥æ•°æ®
```sql
-- ç¤ºä¾‹: LinkedStrategyValidtime
SELECT * FROM t_linkage_strategy_validtime 
WHERE link_device_ip LIKE '192.168.1.%'
ORDER BY link_device_ip;
```

### 3. æµ‹è¯•Controller
```bash
curl http://localhost:8080/test/<æ¨¡å—å>/<æ–¹æ³•å>
```

---

## å‰©ä½™å·¥ä½œ

### ä¸­ä¼˜å…ˆçº§æ¨¡å— (23ä¸ª)
è¿™äº›æ¨¡å—çš„ test_data.sql å¯èƒ½å­˜åœ¨ä»¥ä¸‹é—®é¢˜ä¹‹ä¸€ï¼š
1. è¡¨åä¸XMLä¸ä¸€è‡´
2. ç¼ºå°‘XMLä¸­å¼•ç”¨çš„å…¶ä»–è¡¨æ•°æ®
3. å­—æ®µåä¸åŒ¹é…

**å»ºè®®**: ç»§ç»­ä½¿ç”¨ `check_table_names.py` è„šæœ¬æ‰¹é‡æ£€æŸ¥

### ä½ä¼˜å…ˆçº§æ¨¡å— (éœ€è¦è·¨åº“æŸ¥è¯¢)
- VulAnalysisSub - éœ€è¦ FDW é…ç½®
- SecurityZoneSync - éœ€è¦ FDW é…ç½®

---

## æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶ (8ä¸ª)
```
xml_tests/LinkedStrategyValidtime/test_data.sql
xml_tests/LoginBaseline/test_data.sql
xml_tests/RiskIncidentHistory/test_data.sql
xml_tests/ScenarioData/test_data.sql
xml_tests/ScenarioTemplate/test_data.sql
xml_tests/SecurityType/test_data.sql
xml_tests/SharedData/test_data.sql
xml_tests/TagSearch/test_data.sql
```

### ç”Ÿæˆçš„æŠ¥å‘Š
```
xml_tests/è¡¨åä¸åŒ¹é…é—®é¢˜æ±‡æ€».md - é—®é¢˜æ¸…å•
xml_tests/è¡¨åä¸åŒ¹é…å…¨éƒ¨ä¿®å¤å®ŒæˆæŠ¥å‘Š.md - æœ¬æŠ¥å‘Š
```

---

## æ€»ç»“

âœ… **å·²å®Œæˆ**: 8ä¸ªé«˜ä¼˜å…ˆçº§æ¨¡å—çš„è¡¨åä¸åŒ¹é…é—®é¢˜å…¨éƒ¨ä¿®å¤  
âœ… **æ•°æ®è´¨é‡**: æ¯ä¸ªæ¨¡å—ç”Ÿæˆ5æ¡çœŸå®åœºæ™¯æµ‹è¯•æ•°æ®  
âœ… **æ–‡æ¡£å®Œå–„**: æ¯ä¸ªSQLæ–‡ä»¶éƒ½åŒ…å«è¯¦ç»†çš„å­—æ®µè¯´æ˜å’ŒéªŒè¯è¯­å¥  

ğŸ“‹ **ä¸‹ä¸€æ­¥**: 
1. æµ‹è¯•è¿™8ä¸ªæ¨¡å—çš„Controlleræ˜¯å¦èƒ½æ­£å¸¸æŸ¥è¯¢
2. ç»§ç»­ä¿®å¤å‰©ä½™23ä¸ªä¸­ä¼˜å…ˆçº§æ¨¡å—
3. å¤„ç†éœ€è¦å…³è”è¡¨æ•°æ®çš„æ¨¡å—

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-28  
**å·¥å…·**: check_table_names.py + æ‰‹åŠ¨ä¿®å¤  
**å‚è€ƒ**: postgresql_xml_manual/*.xml + create_table/migrations_ultimate/*.sql
