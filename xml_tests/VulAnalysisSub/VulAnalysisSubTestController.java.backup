package com.test.controller;

import com.dbapp.extension.xdr.vulnerabilityAnalysis.mapper.VulAnalysisSubMapper;
import com.dbapp.extension.xdr.vulnerabilityAnalysis.entity.VulAnalysisSub;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.*;

@RestController
@RequestMapping("/test/vulAnalysisSub")
public class VulAnalysisSubTestController {
    @Autowired
    private VulAnalysisSubMapper mapper;

    @GetMapping("/insertOrUpdate")
    public String testInsertOrUpdate() {
        List<VulAnalysisSub> list = new ArrayList<>();
        VulAnalysisSub vul = new VulAnalysisSub();
        vul.setAssetIp("192.168.1.100");
        vul.setCveId("CVE-2024-0001");
        list.add(vul);
        int rows = mapper.insertOrUpdate(list);
        return "SUCCESS: " + rows;
    }

    @GetMapping("/queryListCount")
    public String testQueryListCount() {
        Map<String, Object> params = new HashMap<>();
        Long count = mapper.queryListCount(params);
        return "SUCCESS: " + count;
    }

    @GetMapping("/queryList")
    public String testQueryList() {
        Map<String, Object> params = new HashMap<>();
        params.put("offset", 0);
        params.put("limit", 10);
        List<Map<String, Object>> list = mapper.queryList(params);
        return "SUCCESS: " + list.size();
    }

    @GetMapping("/querySubListCount")
    public String testQuerySubListCount() {
        Map<String, Object> params = new HashMap<>();
        Long count = mapper.querySubListCount(params);
        return "SUCCESS: " + count;
    }

    @GetMapping("/querySubListCveCount")
    public String testQuerySubListCveCount() {
        Map<String, Object> params = new HashMap<>();
        List<Map<String, Object>> list = mapper.querySubListCveCount(params);
        return "SUCCESS: " + list.size();
    }

    @GetMapping("/querySubList")
    public String testQuerySubList() {
        Map<String, Object> params = new HashMap<>();
        params.put("offset", 0);
        params.put("limit", 10);
        List<Map<String, Object>> list = mapper.querySubList(params);
        return "SUCCESS: " + list.size();
    }

    @GetMapping("/querySubListById")
    public String testQuerySubListById() {
        List<Long> idList = Arrays.asList(1L, 2L, 3L);
        List<Map<String, Object>> list = mapper.querySubListById(idList);
        return "SUCCESS: " + list.size();
    }

    @GetMapping("/updateByParams")
    public String testUpdateByParams() {
        Map<String, Object> params = new HashMap<>();
        params.put("assetIp", "192.168.1.100");
        params.put("ignoreStatus", 1);
        mapper.updateByParams(params);
        return "SUCCESS";
    }

    @GetMapping("/updateByIds")
    public String testUpdateByIds() {
        List<Long> ids = Arrays.asList(1L, 2L, 3L);
        mapper.updateByIds(ids, 1);
        return "SUCCESS";
    }

    @GetMapping("/queryTop10")
    public String testQueryTop10() {
        Map<String, Object> params = new HashMap<>();
        List<Map<String, Object>> list = mapper.queryTop10(params);
        return "SUCCESS: " + list.size();
    }

    @GetMapping("/queryProportion")
    public String testQueryProportion() {
        Map<String, Object> params = new HashMap<>();
        List<Map<String, Object>> list = mapper.queryProportion(params);
        return "SUCCESS: " + list.size();
    }
}
