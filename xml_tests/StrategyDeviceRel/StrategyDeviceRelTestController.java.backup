package com.test.controller;

import com.dbapp.extension.xdr.linkageHandle.mapper.StrategyDeviceRelMapper;
import com.dbapp.extension.xdr.linkageHandle.entity.StrategyDeviceRel;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.*;

@RestController
@RequestMapping("/test/strategyDeviceRel")
public class StrategyDeviceRelTestController {
    @Autowired
    private StrategyDeviceRelMapper mapper;

    @GetMapping("/insert")
    public String testInsert() {
        StrategyDeviceRel rel = new StrategyDeviceRel();
        rel.setStrategyId(2001L);
        rel.setDeviceId("device-001");
        int rows = mapper.insert(rel);
        return "SUCCESS: " + rows;
    }

    @GetMapping("/batchInsert")
    public String testBatchInsert() {
        List<StrategyDeviceRel> list = new ArrayList<>();
        StrategyDeviceRel rel = new StrategyDeviceRel();
        rel.setStrategyId(2001L);
        rel.setDeviceId("device-002");
        list.add(rel);
        int rows = mapper.batchInsert(list);
        return "SUCCESS: " + rows;
    }

    @GetMapping("/update")
    public String testUpdate() {
        StrategyDeviceRel rel = new StrategyDeviceRel();
        rel.setId(1L);
        rel.setDeviceId("device-updated");
        mapper.update(rel);
        return "SUCCESS";
    }

    @GetMapping("/batchInsertOrUpdate")
    public String testBatchInsertOrUpdate() {
        List<StrategyDeviceRel> list = new ArrayList<>();
        StrategyDeviceRel rel = new StrategyDeviceRel();
        rel.setStrategyId(2001L);
        rel.setDeviceId("device-003");
        list.add(rel);
        mapper.batchInsertOrUpdate(list);
        return "SUCCESS";
    }

    @GetMapping("/deleteRelByStrategyId")
    public String testDeleteRelByStrategyId() {
        int rows = mapper.deleteRelByStrategyId(2005L);
        return "SUCCESS: " + rows;
    }

    @GetMapping("/deleteRelByStrategyIdAndDeviceId")
    public String testDeleteRelByStrategyIdAndDeviceId() {
        int rows = mapper.deleteRelByStrategyIdAndDeviceId(2001L, "device-001");
        return "SUCCESS: " + rows;
    }

    @GetMapping("/selectById")
    public String testSelectById() {
        StrategyDeviceRel rel = mapper.selectById(1L);
        return rel != null ? "SUCCESS" : "NOT_FOUND";
    }

    @GetMapping("/getAlarmStrategyList")
    public String testGetAlarmStrategyList() {
        Map<String, Object> params = new HashMap<>();
        List<StrategyDeviceRel> list = mapper.getAlarmStrategyList(params);
        return "SUCCESS: " + list.size();
    }

    @GetMapping("/findDeviceByStrateId")
    public String testFindDeviceByStrateId() {
        List<StrategyDeviceRel> list = mapper.findDeviceByStrateId(2001L);
        return "SUCCESS: " + list.size();
    }

    @GetMapping("/findStrategyIdByDeviceId")
    public String testFindStrategyIdByDeviceId() {
        List<Long> list = mapper.findStrategyIdByDeviceId("device-001");
        return "SUCCESS: " + list.size();
    }

    @GetMapping("/getDeviceCount")
    public String testGetDeviceCount() {
        Integer count = mapper.getDeviceCount(2001L);
        return "SUCCESS: " + count;
    }

    @GetMapping("/updateDeviceIpAndId")
    public String testUpdateDeviceIpAndId() {
        mapper.updateDeviceIpAndId("old-device", "192.168.1.1", "new-device");
        return "SUCCESS";
    }
}
