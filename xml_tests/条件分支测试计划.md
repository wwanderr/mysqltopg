# Intelligence 之后的条件分支测试计划

## 分析结果汇总
- 共分析 27 个模块  
- 13 个模块包含条件语句
- 共 73 个方法需要条件分支测试

## 优先级划分

### 高优先级 (包含 `<choose>`/`<when>` - 需要多个测试用例)

#### 1. **NoticeHistory**
- `getNoticeHistory`: 
  - 测试1: orderByStr 为 null → 默认按 contact_at desc 排序  
  - 测试2: orderByStr 有值 → 按自定义排序

#### 2. **ProhibitHistory**
- `getProhibitListByCondition`:
  - 测试1: orderByStr 为 null → 默认排序
  - 测试2: orderByStr 有值 → 自定义排序
- `listByCondition` / `getProhibitListCount`:
  - 测试1: direction = 'in' → direction = 1
  - 测试2: direction = 'out' → direction = 2
  - 测试3: direction = 其他 → direction = 3
- `getHistoryByBlockList`:
  - 测试1: prohibitDomain 为 true
  - 测试2: prohibitDomain 为 false
- `findEdrProhibitHistory`:
  - 测试1: secondIp != null and secondIp != ''
  - 测试2: secondIp 为空或 null
- `findEdrProhibitHistories`:
  - 测试1: prohibitDomain 为 true
  - 测试2: any 为 true
  - 测试3: 其他情况
- `getAiGentDirectionHistories`:
  - 测试1: exit 为 true (出向)
  - 测试2: exit 为 false (入向)
  - 测试3: 其他情况

#### 3. **RiskIncident**
- `getRiskList`:
  - 测试1: orderByStr 为 null → 默认排序
  - 测试2: orderByStr 有值 → 自定义排序

#### 4. **RiskIncidentHistory**
- `getRiskHistoryList`:
  - 测试1: orderByStr 为 null → 默认排序
  - 测试2: orderByStr 有值 → 自定义排序

#### 5. **VulAnalysisSub**
- `queryList`:
  - 测试1: order 为 null → 默认排序
  - 测试2: order 有值 → 自定义排序
- `queryListCount`:
  - 测试1: order 为 null
  - 测试2: order 有值
- `querySubList`:
  - 测试1: order 为 null → 默认排序
  - 测试2: order 有值 → 自定义排序
- `querySubListCount`:
  - 测试1: order 为 null
  - 测试2: order 有值

#### 6. **ThirdAuth**
- `getThirdAuth`:
  - 测试1: machineCode != null and machineCode != ''
  - 测试2: machineCode 为空或 null

### 中优先级 (包含多个 `<if>` 条件 - 需要1-2个测试用例)

#### 7. **LinkedStrategy**
- `getLinkStrategyList`: 测试有 source/linkDeviceType/linkDeviceIp 等多个可选条件
- `getLinkStrategyListTotal`: 同上
- `getLinkStrategyByIds`: 测试 strategyIds 为空和不为空

#### 8. **LinkedStrategyValidtime**
- `insertValidtime`: 测试 blockDomain 为空和不为空
- `deleteEndtime`: 测试 blockDomain 和 nodeId 条件

#### 9. **OutGoingConfig**
- `selectOutGoingConfig`: 测试 type 和 enable 条件
- `selectKbrCount`: 测试 kdcServerName, serverAddress 条件

#### 10. **ScanHistoryDetail**
- `selectByOption`: 测试多个可选参数
- `selectScanIps`: 同上

#### 11. **StrategyDeviceRel**
- `insert` / `update` / `batchInsertOrUpdate`: 主要是动态字段插入，当前测试已覆盖

#### 12. **RiskIncidentOutGoing** / **RiskIncidentOutGoingHistory**
- `batchInsertOrUpdateIncident`: 动态字段更新，当前测试已覆盖

### 低优先级 (仅用于动态字段构建 - 当前测试已基本覆盖)
- `insert` / `update` 类方法的 `<if>` 条件，主要用于动态构建 INSERT/UPDATE 语句

## 实施计划

### 第一阶段：高优先级模块 (✅ 已完成)
1. ✅ NoticeHistory - 添加 2 个条件分支测试 - **完成**
2. ✅ ProhibitHistory - 添加 9 个条件分支测试 - **完成**
3. ✅ RiskIncident - 添加 2 个条件分支测试 - **完成**
4. ✅ RiskIncidentHistory - 添加 2 个条件分支测试 - **完成**
5. ✅ VulAnalysisSub - 添加 8 个条件分支测试 - **完成**
6. ✅ ThirdAuth - 添加 2 个条件分支测试 - **完成**

**总计**: 25 个新测试方法

### 第二阶段：中优先级模块
7. LinkedStrategy - 添加关键查询方法的条件测试
8. ScanHistoryDetail - 添加多参数查询测试

### 第三阶段：低优先级
- 验证现有测试是否已覆盖动态字段构建

## 测试原则
1. **每个条件分支至少1个测试用例**
2. **测试方法命名规范**: `test{MethodName}_{ConditionDesc}`
   - 例如: `testGetNoticeHistory_DefaultOrder`, `testGetNoticeHistory_CustomOrder`
3. **所有测试方法添加 try-catch 异常处理**
4. **测试参数写死在方法内，方便 Postman 调用**
5. **URL 使用 camelCase 命名**

## 预计工作量
- 高优先级: ~25 个新测试方法
- 中优先级: ~10 个新测试方法  
- 总计: ~35 个新测试方法

## 状态
- [x] **第一阶段: ✅ 已完成** (2026-01-28)
  - 6个模块, 25个测试方法
  - 详见: `条件分支测试完成报告.md`
- [ ] 第二阶段: 待开始
- [ ] 第三阶段: 待开始
