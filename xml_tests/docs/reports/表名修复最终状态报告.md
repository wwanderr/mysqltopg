# è¡¨åä¿®å¤æœ€ç»ˆçŠ¶æ€æŠ¥å‘Š

## æ‰§è¡Œæ—¶é—´
**æŠ¥å‘Šç”Ÿæˆ**: 2026-01-28  
**ä¿®å¤å·¥å…·**: check_table_names.py + æ‰‹åŠ¨ä¿®å¤

---

## ä¸€ã€ä¿®å¤å®Œæˆæƒ…å†µ

### âœ… å·²å®Œæˆä¿®å¤çš„æ¨¡å— (8ä¸ª)

| æ¨¡å—å | åŸé”™è¯¯è¡¨å | æ­£ç¡®è¡¨å | ä¿®å¤è¯´æ˜ |
|--------|-----------|----------|----------|
| **LinkedStrategyValidtime** | t_linked_strategy_validtime | t_linkage_strategy_validtime | linkage vs linkedï¼Œå­—æ®µå…¨éƒ¨é‡å†™ |
| **LoginBaseline** | t_login_baseline | t_scene_login_baseline | ç¼ºå°‘ scene_ å‰ç¼€ |
| **RiskIncidentHistory** | t_risk_incident_history | t_risk_incidents_history | incidents åº”ä¸ºå¤æ•° |
| **ScenarioData** | t_scenario_data | t_event_scenario_data | ç¼ºå°‘ event_ å‰ç¼€ |
| **ScenarioTemplate** | t_scenario_template | t_event_scenario_template | ç¼ºå°‘ event_ å‰ç¼€ |
| **SecurityType** | t_security_type | t_security_types | types åº”ä¸ºå¤æ•° |
| **SharedData** | t_shared_data | t_security_incidents | å®Œå…¨ä¸åŒçš„è¡¨ï¼ˆæŸ¥è¯¢é£é™©äº‹ä»¶è¡¨ï¼‰ |
| **TagSearch** | t_tag_search | t_tag_search_list | ç¼ºå°‘ _list åç¼€ |

**æµ‹è¯•æ•°æ®è´¨é‡**:
- æ¯ä¸ªæ¨¡å— 5 æ¡çœŸå®åœºæ™¯æ•°æ®
- è¦†ç›–å„ç§ä¸šåŠ¡åœºæ™¯
- åŒ…å«å”¯ä¸€çº¦æŸå¤„ç† (ON CONFLICT)
- é™„å¸¦è¯¦ç»†å­—æ®µè¯´æ˜å’ŒéªŒè¯SQL

---

## äºŒã€å‰©ä½™éœ€è¦ä¿®å¤çš„æ¨¡å—

### ğŸ”„ ä¸­ä¼˜å…ˆçº§æ¨¡å— (23ä¸ª - éœ€é€ä¸€æ£€æŸ¥)

æ ¹æ® `check_table_names.py` çš„æ£€æµ‹ç»“æœï¼Œä»¥ä¸‹æ¨¡å—ä»å­˜åœ¨é—®é¢˜ï¼š

#### A. è¡¨åä¸åŒ¹é…ç±» (éœ€è¦ä¿®å¤)

1. **AlarmOutGoingConfig** - å¯èƒ½ç¼ºå°‘å‰ç¼€æˆ–åç¼€
2. **AlarmSendRecord** - è¡¨åå¾…ç¡®è®¤
3. **AlarmStatusTimingTask** - è¡¨åå¾…ç¡®è®¤
4. **AlarmTag** - è¡¨åå¾…ç¡®è®¤
5. **AssetStatisticsInfo** - è¡¨åå¾…ç¡®è®¤
6. **AttackEvent** - å¯èƒ½ç¼ºå°‘å‰ç¼€
7. **AttackEventStatistics** - å¯èƒ½ç¼ºå°‘å‰ç¼€
8. **AttackScenario** - å¯èƒ½ç¼ºå°‘å‰ç¼€
9. **DeviceStatus** - è¡¨åå¾…ç¡®è®¤
10. **EventHandle** - å¯èƒ½ç¼ºå°‘å‰ç¼€
11. **EventOutGoing** - å·²ä¿®å¤ä½†å¯èƒ½è¿˜æœ‰å…¶ä»–è¡¨
12. **EventOutGoingConfig** - å·²ä¿®å¤ä½†å¯èƒ½è¿˜æœ‰å…¶ä»–è¡¨
13. **EventScenarioQueue** - å·²ä¿®å¤ä½†å¯èƒ½è¿˜æœ‰å…¶ä»–è¡¨
14. **EventUpdateCkAlarmQueue** - è¡¨åå¾…ç¡®è®¤
15. **LinkedStrategy** - å¯èƒ½ç¼ºå°‘å‰ç¼€æˆ–åç¼€
16. **NoticeHistory** - å¯èƒ½ç¼ºå°‘å‰ç¼€
17. **OutGoingConfig** - å¤æ‚ï¼Œæ¶‰åŠ3ä¸ªé…ç½®è¡¨
18. **QueryTemplate** - è¡¨åå¾…ç¡®è®¤
19. **ScanHistoryDetail** - è¡¨åå¾…ç¡®è®¤
20. **SecurityAlarmHandle** - è¡¨åå¾…ç¡®è®¤
21. **SecurityZoneSync** - è·¨åº“æŸ¥è¯¢ï¼Œéœ€è¦FDW
22. **StrategyDeviceRel** - è¡¨åå¾…ç¡®è®¤
23. **VulAnalysisSub** - è·¨åº“æŸ¥è¯¢ï¼Œéœ€è¦FDW

#### B. XML Mapper ç¼ºå¤±ç±» (éœ€è¦æ‰¾åˆ°XMLæ–‡ä»¶)

- **SecurityEvent** - XML Mapper æœªæ‰¾åˆ°

---

## ä¸‰ã€è¡¨åæ¨¡å¼æ€»ç»“

### 1. å¸¸è§å‰ç¼€

| å‰ç¼€ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `t_event_` | äº‹ä»¶ç›¸å…³ | t_event_scenario_data, t_event_template |
| `t_scene_` | åœºæ™¯ç›¸å…³ | t_scene_login_baseline |
| `t_aigent_` | AIä»£ç†ç›¸å…³ | t_aigent_shared_data |
| `t_security_` | å®‰å…¨ç›¸å…³ | t_security_incidents, t_security_types |
| `t_risk_` | é£é™©ç›¸å…³ | t_risk_incidents_history |
| `t_linkage_` | è”åŠ¨ç›¸å…³ | t_linkage_strategy_validtime |

### 2. å¸¸è§åç¼€

| åç¼€ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `_history` | å†å²è®°å½• | t_risk_incidents_history |
| `_config` | é…ç½®è¡¨ | t_event_out_going_config |
| `_data` | æ•°æ®è¡¨ | t_event_scenario_data |
| `_template` | æ¨¡æ¿è¡¨ | t_event_scenario_template |
| `_list` | åˆ—è¡¨è¡¨ | t_tag_search_list |
| `_queue` | é˜Ÿåˆ—è¡¨ | t_event_scenario_queue |

### 3. å•å¤æ•°è§„åˆ™

| ç±»å‹ | ç¤ºä¾‹ |
|------|------|
| å¤æ•°å½¢å¼ | t_security_types, t_risk_incidents_history |
| å•æ•°å½¢å¼ | t_linkage_strategy_validtime |

---

## å››ã€ä¿®å¤ç­–ç•¥

### æ–¹æ³•1: è‡ªåŠ¨åŒ–æ£€æµ‹ + æ‰‹åŠ¨ä¿®å¤ (æ¨è)

```bash
# 1. è¿è¡Œæ£€æµ‹è„šæœ¬
cd xml_tests
python check_table_names.py

# 2. æŸ¥çœ‹å…·ä½“æ¨¡å—çš„XML
code ../postgresql_xml_manual/<æ¨¡å—å>Mapper.xml

# 3. æŸ¥çœ‹å»ºè¡¨DDL
code ../create_table/migrations_ultimate/V*<è¡¨å>*.sql

# 4. ä¿®å¤ test_data.sql
code <æ¨¡å—å>/test_data.sql
```

### æ–¹æ³•2: æ‰¹é‡ä¿®å¤è„šæœ¬

åˆ›å»º `batch_fix_table_names.py`:
```python
# è¯»å– check_table_names.py çš„è¾“å‡º
# å¯¹äºæ¯ä¸ªæœ‰é—®é¢˜çš„æ¨¡å—:
#   1. è¯»å– XML Mapper
#   2. æå–ä¸»è¡¨å
#   3. æŸ¥æ‰¾å»ºè¡¨DDL
#   4. ç”Ÿæˆæ ‡å‡†çš„ test_data.sql
```

---

## äº”ã€å·²ä¿®å¤æ¨¡å—çš„æµ‹è¯•éªŒè¯

### 1. SQLå±‚é¢éªŒè¯

```bash
# å¯¹äºæ¯ä¸ªå·²ä¿®å¤çš„æ¨¡å—
cd xml_tests/<æ¨¡å—å>
psql -U dbapp -d your_database -f test_data.sql

# æŸ¥çœ‹æ’å…¥ç»“æœ
psql -U dbapp -d your_database -c "SELECT * FROM <è¡¨å> WHERE <æ¡ä»¶>"
```

### 2. Controllerå±‚é¢éªŒè¯

```bash
# å¯åŠ¨åº”ç”¨
cd /path/to/your/app
mvn spring-boot:run

# æµ‹è¯•å„ä¸ªendpoint
curl http://localhost:8080/test/linkedStrategyValidtime/insertValidtime
curl http://localhost:8080/test/loginBaseline/cleanOvertimeData
curl http://localhost:8080/test/riskIncidentHistory/getRiskHistoryList
# ... å…¶ä»–æµ‹è¯•
```

---

## å…­ã€è´¨é‡ä¿è¯

### A. å·²ä¿®å¤æ¨¡å—çš„ç‰¹å¾

âœ… **è¡¨åæ­£ç¡®**: ä¸ XML Mapper ä¸­çš„ä¸»è¡¨åä¸€è‡´  
âœ… **å­—æ®µå®Œæ•´**: åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ  
âœ… **æ•°æ®çœŸå®**: 5æ¡ä»¥ä¸ŠçœŸå®ä¸šåŠ¡åœºæ™¯æ•°æ®  
âœ… **çº¦æŸå¤„ç†**: æ­£ç¡®ä½¿ç”¨ ON CONFLICT  
âœ… **æ³¨é‡Šæ¸…æ™°**: åŒ…å«å­—æ®µè¯´æ˜å’ŒéªŒè¯SQL  

### B. æ–‡ä»¶ç»“æ„æ ‡å‡†

```sql
-- ================================================================
-- æµ‹è¯•æ•°æ®ï¼š<æ¨¡å—å>ï¼ˆä¸­æ–‡åï¼‰
-- è¡¨: <æ­£ç¡®çš„è¡¨å>
-- ç”Ÿæˆæ—¶é—´: 2026-01-28
-- ================================================================

-- æ¸…ç†æµ‹è¯•æ•°æ®
DELETE FROM "<è¡¨å>" WHERE <æ¸…ç†æ¡ä»¶>;

-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO "<è¡¨å>" (
    "å­—æ®µ1",
    "å­—æ®µ2",
    ...
) VALUES
(å€¼1, å€¼2, ...),
...
ON CONFLICT (...) DO UPDATE SET ...;

-- æ›´æ–°åºåˆ—
SELECT setval('"<è¡¨å>_id_seq"', <æœ€å¤§ID>, true);

-- ================================================================
-- è¯´æ˜
-- ================================================================
-- å­—æ®µè¯´æ˜
-- ä¸šåŠ¡é€»è¾‘è¯´æ˜

-- ================================================================
-- éªŒè¯æ•°æ®
-- ================================================================
-- SELECT * FROM "<è¡¨å>" WHERE ...;
```

---

## ä¸ƒã€ä¸‹ä¸€æ­¥å·¥ä½œè®¡åˆ’

### é˜¶æ®µ1: å®Œæˆå‰©ä½™23ä¸ªæ¨¡å—ä¿®å¤ (ä¼˜å…ˆçº§: é«˜)

1. æ‰¹é‡è¿è¡Œ check_table_names.py
2. å¯¹æ¯ä¸ªé”™è¯¯æ¨¡å—:
   - è¯»å– XML Mapper
   - æ‰¾åˆ°å»ºè¡¨DDL
   - é‡å†™ test_data.sql
3. é‡æ–°éªŒè¯

**é¢„è®¡å·¥ä½œé‡**: 2-3å°æ—¶

### é˜¶æ®µ2: å¤„ç†è·¨åº“æŸ¥è¯¢æ¨¡å— (ä¼˜å…ˆçº§: ä¸­)

- VulAnalysisSub
- SecurityZoneSync

**å‰ç½®æ¡ä»¶**: é…ç½® PostgreSQL FDW

### é˜¶æ®µ3: å…¨é¢æµ‹è¯• (ä¼˜å…ˆçº§: é«˜)

1. æ‰§è¡Œæ‰€æœ‰ test_data.sql
2. æµ‹è¯•æ‰€æœ‰ Controller endpoint
3. éªŒè¯ Mapper æŸ¥è¯¢ç»“æœ
4. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

---

## å…«ã€æ–‡ä»¶æ¸…å•

### å·²ä¿®æ”¹æ–‡ä»¶ (8ä¸ª)

```
xml_tests/LinkedStrategyValidtime/test_data.sql  âœ…
xml_tests/LoginBaseline/test_data.sql           âœ…
xml_tests/RiskIncidentHistory/test_data.sql     âœ…
xml_tests/ScenarioData/test_data.sql            âœ…
xml_tests/ScenarioTemplate/test_data.sql        âœ…
xml_tests/SecurityType/test_data.sql            âœ…
xml_tests/SharedData/test_data.sql              âœ…
xml_tests/TagSearch/test_data.sql               âœ…
```

### ç”Ÿæˆçš„æŠ¥å‘Š

```
xml_tests/check_table_names.py                       - æ£€æµ‹è„šæœ¬
xml_tests/è¡¨åä¸åŒ¹é…é—®é¢˜æ±‡æ€».md                      - åˆå§‹é—®é¢˜æ¸…å•
xml_tests/è¡¨åä¸åŒ¹é…å…¨éƒ¨ä¿®å¤å®ŒæˆæŠ¥å‘Š.md              - 8ä¸ªæ¨¡å—ä¿®å¤æŠ¥å‘Š
xml_tests/è¡¨åä¿®å¤æœ€ç»ˆçŠ¶æ€æŠ¥å‘Š.md                    - æœ¬æŠ¥å‘Š (å…¨å±€çŠ¶æ€)
```

---

## ä¹ã€å…³é”®ç»éªŒæ€»ç»“

### âœ… æˆåŠŸç»éªŒ

1. **è¡¨åæŸ¥æ‰¾**: å§‹ç»ˆä»¥ XML Mapper ä¸ºå‡†ï¼Œè€Œä¸æ˜¯çŒœæµ‹
2. **å»ºè¡¨DDL**: ç”¨ glob_file_search å¿«é€Ÿæ‰¾åˆ°å»ºè¡¨æ–‡ä»¶
3. **å­—æ®µå®Œæ•´**: å‚è€ƒ DDL ç¡®ä¿å­—æ®µåã€ç±»å‹ã€çº¦æŸéƒ½æ­£ç¡®
4. **æµ‹è¯•æ•°æ®**: 5æ¡çœŸå®åœºæ™¯æ•°æ® > 100æ¡ç®€å•æ•°æ®
5. **æ–‡æ¡£åŒ–**: æ¯ä¸ª SQL æ–‡ä»¶éƒ½åŒ…å«è¯¦ç»†è¯´æ˜

### âš ï¸ å¸¸è§é™·é˜±

1. **è¡¨åå‰ç¼€**: å¾ˆå¤šè¡¨æœ‰ `event_`, `scene_`, `security_` ç­‰å‰ç¼€
2. **å•å¤æ•°**: æ³¨æ„ `incidents` vs `incident`, `types` vs `type`
3. **JOINè¡¨æ··æ·†**: Mapper ä¸­å¯èƒ½ JOIN å¤šå¼ è¡¨ï¼Œè¦æ‰¾åˆ°ä¸»è¡¨
4. **è·¨åº“æŸ¥è¯¢**: æœ‰äº› Mapper æŸ¥è¯¢ bigdata_web åº“ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
5. **åºåˆ—å**: è®°å¾—æ›´æ–°åºåˆ—çš„å½“å‰å€¼

---

## åã€æ€»ç»“

### å½“å‰è¿›åº¦

- âœ… å·²å®Œæˆ: 8/31 æ¨¡å— (25.8%)
- ğŸ”„ å¾…ä¿®å¤: 23/31 æ¨¡å— (74.2%)
- â¸ï¸ ç‰¹æ®Šæƒ…å†µ: 2 æ¨¡å—éœ€è¦FDWé…ç½®

### æ•´ä½“è´¨é‡

- å·²ä¿®å¤æ¨¡å—çš„æ•°æ®è´¨é‡: â­â­â­â­â­
- æ–‡æ¡£å®Œå–„ç¨‹åº¦: â­â­â­â­â­
- æµ‹è¯•è¦†ç›–ç‡: éœ€è¦åç»­éªŒè¯

### å»ºè®®

1. **ä¼˜å…ˆä¿®å¤**: å‰©ä½™23ä¸ªä¸­ä¼˜å…ˆçº§æ¨¡å—
2. **æ‰¹é‡å¤„ç†**: å¼€å‘è‡ªåŠ¨åŒ–è„šæœ¬åŠ é€Ÿä¿®å¤
3. **æŒç»­éªŒè¯**: ä¿®å¤ä¸€æ‰¹æµ‹è¯•ä¸€æ‰¹
4. **æ–‡æ¡£ç»´æŠ¤**: ä¿æŒæŠ¥å‘Šæ›´æ–°

---

**æŠ¥å‘Šä½œè€…**: AI Assistant  
**å®¡æ ¸çŠ¶æ€**: å¾…ç”¨æˆ·ç¡®è®¤  
**ä¸‹æ¬¡æ›´æ–°**: å®Œæˆå‰©ä½™23ä¸ªæ¨¡å—å
