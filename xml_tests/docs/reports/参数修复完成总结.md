# Mapperå‚æ•°ç±»å‹ä¿®å¤å®Œæˆæ€»ç»“

## ä¿®å¤æ¦‚è§ˆ

### âœ… å·²å®Œæˆä¿®å¤ï¼ˆ3ä¸ªMapperï¼‰

| Mapper | ä¿®å¤æ–¹æ³•æ•° | çŠ¶æ€ | å¤‡æ³¨ |
|--------|-----------|------|------|
| AttackKnowledgeMapper | 3ä¸ªæ–¹æ³• | âœ… å®Œæˆ | selectListByParams, updateByCode, batchInsert |
| AssetInfoMapper | 1ä¸ªæ–¹æ³• | âœ… å®Œæˆ | queryAssets |
| OutGoingConfigMapper | 5ä¸ªæ–¹æ³• | âœ… å®Œæˆ | æ‰€æœ‰æŸ¥è¯¢å’Œæ›´æ–°æ–¹æ³• |

**æ€»è®¡ï¼š** 3ä¸ªMapperï¼Œ9ä¸ªæ–¹æ³•å·²ä¿®å¤

### ğŸ“‹ å¾…ä¿®å¤ï¼ˆ13ä¸ªMapperï¼Œå…±43ä¸ªæ–¹æ³•ï¼‰

è¯¦è§ `Mapperå‚æ•°ç±»å‹ä¿®å¤æŠ¥å‘Š.md`

## å…³é”®ä¿®å¤ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šAttackKnowledgeMapper.selectListByParams

**ä¿®å¤å‰ï¼ˆâŒ é”™è¯¯ï¼‰ï¼š**
```java
List<AttackKnowledge> selectListByParams(Map<String, Object> params);
```

**ä¿®å¤åï¼ˆâœ… æ­£ç¡®ï¼‰ï¼š**
```java
List<AttackKnowledge> selectListByParams(String os, String perspective, String type);
```

**Controllerè°ƒç”¨ä¿®å¤å‰ï¼ˆâŒï¼‰ï¼š**
```java
Map<String, Object> params = new HashMap<>();
params.put("os", "Windows");
params.put("perspective", "all");
params.put("type", "endpoint");
List<AttackKnowledge> result = mapper.selectListByParams(params);
```

**Controllerè°ƒç”¨ä¿®å¤åï¼ˆâœ…ï¼‰ï¼š**
```java
String os = "Windows";
String perspective = "all";
String type = "endpoint";
List<AttackKnowledge> result = mapper.selectListByParams(os, perspective, type);
```

### ç¤ºä¾‹2ï¼šAttackKnowledgeMapper.batchInsert

**ä¿®å¤å‰ï¼ˆâŒ é”™è¯¯ï¼‰ï¼š**
```java
void batchInsert(Map<String, Object> params);

// Controllerè°ƒç”¨
Map<String, Object> params = new HashMap<>();
params.put("attackUpdateList", attackUpdateList);
mapper.batchInsert(params);
```

**ä¿®å¤åï¼ˆâœ… æ­£ç¡®ï¼‰ï¼š**
```java
void batchInsert(List<AttackKnowledge> attackUpdateList);  // å‚æ•°åå¿…é¡»ä¸XMLçš„collectionåŒ¹é…

// Controllerè°ƒç”¨
mapper.batchInsert(attackUpdateList);  // ç›´æ¥ä¼ List
```

**XMLä¸­çš„å¯¹åº”å®šä¹‰ï¼š**
```xml
<insert id="batchInsert">
    INSERT INTO t_attack_knowledge (...)
    VALUES
    <foreach collection="attackUpdateList" item="attck" separator=",">
        (...)
    </foreach>
</insert>
```

## æ ¸å¿ƒä¿®å¤åŸåˆ™

### 1. å‚æ•°æ•°é‡åˆ¤æ–­
- **2-6ä¸ªå‚æ•°** â†’ ä½¿ç”¨ç‹¬ç«‹å‚æ•°
- **>=10ä¸ªå‚æ•°** â†’ ä½¿ç”¨å®ä½“å¯¹è±¡
- **æœ‰collectionå±æ€§** â†’ ä½¿ç”¨Listï¼Œå‚æ•°åå¿…é¡»åŒ¹é…

### 2. å‚æ•°ç±»å‹æ¨æ–­è§„åˆ™

| å‚æ•°åç‰¹å¾ | Javaç±»å‹ |
|-----------|---------|
| ä»¥`Id`ç»“å°¾ | `Integer` |
| `enable`, `is*` | `Boolean` |
| `offset`, `size`, `count` | `int` |
| `time`, `date` | `String` |
| `ip`, `address`, `code`, `name` | `String` |

### 3. XMLä¸­çš„åˆ¤æ–­ä¾æ®

æŸ¥çœ‹XMLçš„testæ¡ä»¶ï¼š
```xml
<!-- ç‹¬ç«‹å‚æ•°çš„å†™æ³• -->
<if test="os != null and os != ''">
    AND tk.os = #{os}
</if>

<!-- Mapå‚æ•°çš„å†™æ³•ï¼ˆè¾ƒå°‘è§ï¼‰-->
<if test="params.os != null">
    AND tk.os = #{params.os}
</if>
```

## å·²ä¿®å¤æ–‡ä»¶æ¸…å•

### AttackKnowledgeMapper
- âœ… `xml_tests/AttackKnowledge/AttackKnowledgeMapper.java` - æ¥å£ä¿®å¤å®Œæˆ
- âœ… `xml_tests/AttackKnowledge/AttackKnowledgeTestController.java` - Controllerä¿®å¤å®Œæˆ
- âœ… `xml_tests/AttackKnowledge/test_data.sql` - æµ‹è¯•æ•°æ®å®Œæ•´

### AssetInfoMapper
- âœ… `xml_tests/AssetInfo/AssetInfoMapper.java` - æ¥å£ä¿®å¤å®Œæˆ
- âœ… `xml_tests/AssetInfo/AssetInfoTestController.java` - Controllerä¿®å¤å®Œæˆ

### OutGoingConfigMapper
- âœ… `xml_tests/OutGoingConfig/OutGoingConfigMapper.java` - æ¥å£ä¿®å¤å®Œæˆ
- âœ… `xml_tests/OutGoingConfig/OutGoingConfigTestController.java` - Controllerä¿®å¤å®Œæˆ
- âœ… `xml_tests/OutGoingConfig/test_data.sql` - æµ‹è¯•æ•°æ®å®Œæ•´

## æµ‹è¯•éªŒè¯

ä¿®å¤åï¼ŒControlleræµ‹è¯•æ–¹æ³•å¯ä»¥ç›´æ¥é€šè¿‡Postman GETè¯·æ±‚è°ƒç”¨ï¼š

```
# AttackKnowledgeæµ‹è¯•
GET http://localhost:8080/test/attackKnowledge/test-select-list-by-params
GET http://localhost:8080/test/attackKnowledge/test-select-by-parent-code
GET http://localhost:8080/test/attackKnowledge/test-query-id-by-tactic-name
GET http://localhost:8080/test/attackKnowledge/test-query-name-by-code
GET http://localhost:8080/test/attackKnowledge/test-query-parent-id
GET http://localhost:8080/test/attackKnowledge/test-select-tactic
GET http://localhost:8080/test/attackKnowledge/test-update-by-code
GET http://localhost:8080/test/attackKnowledge/test-batch-insert

# AssetInfoæµ‹è¯•
GET http://localhost:8080/test/assetInfo/test-query-assets-count
GET http://localhost:8080/test/assetInfo/test-query-assets

# OutGoingConfigæµ‹è¯•
GET http://localhost:8080/test/outGoingConfig/test-select-outgoing-config
GET http://localhost:8080/test/outGoingConfig/test-select-config-by-id
GET http://localhost:8080/test/outGoingConfig/test-select-outgoing-config-by-page
GET http://localhost:8080/test/outGoingConfig/test-update-switch-by-id
```

## åç»­å·¥ä½œ

### ç«‹å³éœ€è¦åšçš„
1. âš ï¸  **ä¼˜å…ˆä¿®å¤ProhibitHistoryMapper**ï¼ˆ7ä¸ªæ–¹æ³•ï¼Œé«˜é¢‘ä½¿ç”¨ï¼‰
2. âš ï¸  **ä¼˜å…ˆä¿®å¤SecurityEventMapper**ï¼ˆ9ä¸ªæ–¹æ³•ï¼Œæ ¸å¿ƒä¸šåŠ¡ï¼‰
3. âš ï¸  **ä¼˜å…ˆä¿®å¤RiskIncidentMapper**ï¼ˆ7ä¸ªæ–¹æ³•ï¼Œæ ¸å¿ƒä¸šåŠ¡ï¼‰

### å¯ä»¥å»¶åçš„
- BlockHistoryMapperï¼ˆ3ä¸ªæ–¹æ³•ï¼‰
- IntelligenceMapperï¼ˆ3ä¸ªæ–¹æ³•ï¼‰
- LinkedStrategyMapperï¼ˆ2ä¸ªæ–¹æ³•ï¼‰
- å…¶ä»–10ä¸ªMapperï¼ˆå…±çº¦20ä¸ªæ–¹æ³•ï¼‰

## å·¥å…·å’Œè„šæœ¬

1. **check_mapper_params.py** - æ£€æŸ¥æ‰€æœ‰Mapperå‚æ•°ç±»å‹
2. **batch_fix_mapper_params.py** - æ‰¹é‡ä¿®å¤è„šæœ¬ï¼ˆå¾…å®Œå–„ï¼‰
3. **Mapperå‚æ•°ç±»å‹ä¿®å¤æŠ¥å‘Š.md** - è¯¦ç»†ä¿®å¤æŒ‡å—

## æ€»ç»“

âœ… **ä¿®å¤æˆåŠŸçš„å…³é”®ç‚¹ï¼š**
1. æ­£ç¡®è¯†åˆ«XMLä¸­çš„å‚æ•°å¼•ç”¨æ–¹å¼ï¼ˆ#{xxx}ï¼‰
2. æ ¹æ®å‚æ•°æ•°é‡å’Œè¯­ä¹‰åˆ¤æ–­åº”è¯¥ç”¨ç‹¬ç«‹å‚æ•°è¿˜æ˜¯å®ä½“å¯¹è±¡
3. å¯¹äºcollectionå‚æ•°ï¼Œç¡®ä¿Mapperå‚æ•°åä¸XMLä¸­çš„collectionåç§°ä¸€è‡´
4. Controllerä¸­ç›´æ¥ä¼ é€’å‚æ•°å€¼ï¼Œä¸ä½¿ç”¨MapåŒ…è£…

âŒ **å¸¸è§é”™è¯¯ï¼š**
1. æ‰€æœ‰æ–¹æ³•éƒ½ç”¨Map<String, Object>ä¼ å‚
2. collectionå‚æ•°ç”¨Mapè€Œä¸æ˜¯List
3. å‚æ•°åä¸XMLä¸­ä¸åŒ¹é…
4. å‚æ•°ç±»å‹ä¸æ­£ç¡®ï¼ˆå¦‚æŠŠBooleanå†™æˆIntegerï¼‰

ğŸ“ **å»ºè®®ï¼š**
- ä¿®å¤ä¸€ä¸ªMapperåç«‹å³æµ‹è¯•ï¼Œä¸è¦ç§¯ç´¯é—®é¢˜
- å‚è€ƒå·²ä¿®å¤çš„3ä¸ªMapperä½œä¸ºæ¨¡æ¿
- æœ‰ç–‘é—®æ—¶æŸ¥çœ‹XMLä¸­çš„å®é™…SQLå’Œtestæ¡ä»¶
