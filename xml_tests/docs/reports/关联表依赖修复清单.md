# å…³è”è¡¨ä¾èµ–ä¿®å¤æ¸…å•

> ç”Ÿæˆæ—¶é—´ï¼š2026-01-26  
> è¯´æ˜ï¼šéƒ¨åˆ†æµ‹è¯•æ¨¡å—çš„ XML Mapper ä¸­åŒ…å« JOIN æŸ¥è¯¢ï¼Œéœ€è¦åœ¨ test_data.sql ä¸­åŒæ—¶æ’å…¥å…³è”è¡¨çš„æ•°æ®

---

## âœ… å·²ä¿®å¤æ¨¡å—ï¼ˆå…±4ä¸ªï¼‰

### 1. EventScenarioQueue âœ…
- **ä¸»è¡¨**: `t_event_scenario_queue`
- **å…³è”è¡¨**: `t_security_incidents`
- **å…³è”å­—æ®µ**: `event_code`
- **ä¿®å¤å†…å®¹**: test_data.sql ä¸­å·²æ·»åŠ  t_security_incidents çš„5æ¡æµ‹è¯•æ•°æ®
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

### 2. SecurityEvent âœ… **å¤æ‚**
- **ä¸»è¡¨**: `t_security_incidents`
- **å…³è”è¡¨**: `t_event_template`, `t_query_template`, `t_event_scenario_data`
- **å…³è”å­—æ®µ**: `template_id`, `template_code`, `incident_id`
- **ä¿®å¤å†…å®¹**: test_data.sql ä¸­å·²æ·»åŠ 3ä¸ªå…³è”è¡¨çš„å®Œæ•´æµ‹è¯•æ•°æ®ï¼ˆå„5æ¡è®°å½•ï¼‰
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

### 3. RiskIncident âœ… **å¤æ‚**
- **ä¸»è¡¨**: `t_risk_incidents`
- **å…³è”è¡¨**: `t_event_template`, `t_query_template`
- **å…³è”å­—æ®µ**: `template_id`, `template_code`
- **ä¿®å¤å†…å®¹**: test_data.sql ä¸­å·²æ·»åŠ 2ä¸ªå…³è”è¡¨çš„å®Œæ•´æµ‹è¯•æ•°æ®ï¼ˆå„5æ¡è®°å½•ï¼‰
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

### 4. ProhibitHistory âœ… **ä¸­ç­‰**
- **ä¸»è¡¨**: `t_prohibit_history`
- **å…³è”è¡¨**: `t_linked_strategy`
- **å…³è”å­—æ®µ**: `strategy_id`
- **ä¿®å¤å†…å®¹**: test_data.sql ä¸­å·²æ·»åŠ  t_linked_strategy çš„5æ¡ç­–ç•¥æ•°æ®
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## âš ï¸ å¾…ä¿®å¤æ¨¡å—ï¼ˆå…±7ä¸ªï¼‰

### 5. SecurityEvent âš ï¸ **å¤æ‚**
- **ä¸»è¡¨**: `t_security_incidents`
- **å…³è”è¡¨**: 
  - `t_query_template` (template_code)
  - `t_event_template` (template_id)
  - `t_event_scenario_data` (incident_id)
  - `t_alarm_status_timing_task` (associated_field)
  - `t_event_thread` (template_id)
- **å½±å“æ–¹æ³•**: 
  - `selectByIdList` - JOIN t_query_template, t_event_template
  - `getByMultiSelectIds` - JOIN t_query_template, t_event_scenario_data, t_event_template
  - `getRiskList` - JOIN t_query_template, t_event_scenario_data, t_event_template, t_alarm_status_timing_task
  - `getExistThreadEvents` - JOIN t_event_template
  - `deleteLowPriority` - JOIN t_event_template
- **ä¿®å¤å»ºè®®**: éœ€è¦åœ¨ test_data.sql ä¸­æ·»åŠ è‡³å°‘4ä¸ªå…³è”è¡¨çš„æ•°æ®

---

### 5. NoticeHistory âš ï¸ **ç®€å•**
- **ä¸»è¡¨**: `t_notice_history`
- **å…³è”è¡¨**: `t_linked_strategy`
- **å…³è”å­—æ®µ**: `strategy_id`
- **å½±å“æ–¹æ³•**:
  - `getNoticeListCount` - RIGHT JOIN t_linked_strategy
  - `getNoticeHistory` - RIGHT JOIN t_linked_strategy
- **ä¿®å¤å»ºè®®**: éœ€è¦åœ¨ test_data.sql ä¸­æ·»åŠ  t_linked_strategy çš„ç­–ç•¥æ•°æ®

---

### 6. OutGoingConfig âš ï¸ **å¤æ‚**
- **ä¸»è¡¨**: `t_out_going_config`
- **å…³è”è¡¨**: 
  - `t_alarm_out_going_config` (alarm_config_id)
  - `t_event_out_going_config` (event_config_id)
  - `t_risk_out_going_config` (risk_config_id)
- **å½±å“æ–¹æ³•**: æ‰€æœ‰æŸ¥è¯¢æ–¹æ³•ï¼ˆä½¿ç”¨å…¬å…± selectFrom SQLç‰‡æ®µï¼‰
- **ä¿®å¤å»ºè®®**: éœ€è¦åœ¨ test_data.sql ä¸­æ·»åŠ 3ä¸ªå¤–å‘é…ç½®è¡¨çš„æ•°æ®

---

### 7. RiskIncidentOutGoing âš ï¸ **ç®€å•**
- **ä¸»è¡¨**: `t_risk_incidents_out_going`
- **å…³è”è¡¨**: `t_risk_incidents`
- **å…³è”å­—æ®µ**: `event_code`
- **å½±å“æ–¹æ³•**: 
  - `queryOutGoingList` - LEFT JOIN t_risk_incidents
- **ä¿®å¤å»ºè®®**: éœ€è¦åœ¨ test_data.sql ä¸­æ·»åŠ  t_risk_incidents çš„æ•°æ®

---

### 8. RiskIncidentOutGoingHistory âš ï¸ **ç®€å•**
- **ä¸»è¡¨**: `t_risk_incidents_out_going_history`
- **å…³è”è¡¨**: `t_risk_incidents`
- **å…³è”å­—æ®µ**: `event_code`
- **å½±å“æ–¹æ³•**:
  - `queryOutGoingList` - LEFT JOIN t_risk_incidents
- **ä¿®å¤å»ºè®®**: éœ€è¦åœ¨ test_data.sql ä¸­æ·»åŠ  t_risk_incidents çš„æ•°æ®

---

### 9. StrategyDeviceRel âš ï¸ **ç®€å•**
- **ä¸»è¡¨**: `t_strategy_device_rel`
- **å…³è”è¡¨**: `t_linked_strategy`
- **å…³è”å­—æ®µ**: `strategy_id`
- **å½±å“æ–¹æ³•**:
  - `getAlarmStrategyList` - LEFT JOIN t_linked_strategy
- **ä¿®å¤å»ºè®®**: éœ€è¦åœ¨ test_data.sql ä¸­æ·»åŠ  t_linked_strategy çš„ç­–ç•¥æ•°æ®

---

### 10. VulAnalysisSub âš ï¸ **FDWè·¨åº“**
- **ä¸»è¡¨**: `t_vul_analysis_sub`
- **å…³è”è¡¨**: `bigdata_web.t_asset_info` (è·¨åº“)
- **å…³è”å­—æ®µ**: `asset_ip`
- **å½±å“æ–¹æ³•**: å¤šä¸ªæŸ¥è¯¢æ–¹æ³•æ¶‰åŠèµ„äº§ä¿¡æ¯
- **ä¿®å¤å»ºè®®**: 
  - ç¡®ä¿ FDW å·²é…ç½®ï¼ˆV20260122133659054__setup_fdw_bigdata_web.sqlï¼‰
  - æˆ–è€…åœ¨æœ¬åœ°åˆ›å»º bigdata_web schema å’Œ t_asset_info è¡¨
  - æ·»åŠ æµ‹è¯•èµ„äº§æ•°æ®

---

### 11. SecurityZoneSync âš ï¸ **FDWè·¨åº“**
- **ä¸»è¡¨**: `t_security_zone_sync`
- **å…³è”è¡¨**: `bigdata_web.t_ailpha_security_zone` (è·¨åº“)
- **å…³è”å­—æ®µ**: å®‰å…¨åŸŸID
- **å½±å“æ–¹æ³•**: åŒæ­¥æŸ¥è¯¢æ–¹æ³•
- **ä¿®å¤å»ºè®®**: 
  - ç¡®ä¿ FDW å·²é…ç½®
  - æˆ–è€…åœ¨æœ¬åœ°åˆ›å»ºå¯¹åº”è¡¨
  - æ·»åŠ æµ‹è¯•å®‰å…¨åŸŸæ•°æ®

---

## ğŸ“‹ ä¿®å¤ä¼˜å…ˆçº§

### âœ… é«˜ä¼˜å…ˆçº§ï¼ˆå·²å®Œæˆï¼‰
1. âœ… **EventScenarioQueue** - äº‹ä»¶åœºæ™¯é˜Ÿåˆ—
2. âœ… **SecurityEvent** - äº‹ä»¶æŸ¥è¯¢æ ¸å¿ƒåŠŸèƒ½ï¼Œå…³è”è¡¨å¤š
3. âœ… **RiskIncident** - é£é™©äº‹ä»¶æ ¸å¿ƒåŠŸèƒ½ï¼Œå…³è”è¡¨å¤š
4. âœ… **ProhibitHistory** - å°å µå†å²æ ¸å¿ƒåŠŸèƒ½

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå¾…ä¿®å¤ï¼‰
5. **OutGoingConfig** - å¤–å‘é…ç½®æŸ¥è¯¢
6. **NoticeHistory** - é€šçŸ¥å†å²æŸ¥è¯¢
7. **StrategyDeviceRel** - ç­–ç•¥è®¾å¤‡å…³è”

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆå¾…ä¿®å¤ï¼‰
8. **RiskIncidentOutGoing** - é£é™©äº‹ä»¶å¤–å‘
9. **RiskIncidentOutGoingHistory** - é£é™©äº‹ä»¶å¤–å‘å†å²

### ğŸ”µ ç‰¹æ®Šå¤„ç†ï¼ˆè·¨åº“æŸ¥è¯¢ï¼Œå¾…ä¿®å¤ï¼‰
10. **VulAnalysisSub** - éœ€è¦ FDW æˆ–æœ¬åœ°è¡¨
11. **SecurityZoneSync** - éœ€è¦ FDW æˆ–æœ¬åœ°è¡¨

---

## ğŸ› ï¸ ä¿®å¤æ¨¡æ¿

### é€šç”¨ä¿®å¤æ¨¡å¼

```sql
-- ============================================
-- æµ‹è¯•æ•°æ®ï¼š[æ¨¡å—å]
-- ä¸»è¡¨ï¼š[ä¸»è¡¨å]
-- å…³è”è¡¨ï¼š[å…³è”è¡¨å]
-- ç”Ÿæˆæ—¶é—´ï¼š2026-01-26
-- ============================================

-- ==========================================
-- 1. å…ˆæ’å…¥å…³è”è¡¨æ•°æ®
-- ==========================================
DELETE FROM "[å…³è”è¡¨å]" WHERE [æ¡ä»¶];

INSERT INTO "[å…³è”è¡¨å]" ([å­—æ®µåˆ—è¡¨])
VALUES 
([æµ‹è¯•æ•°æ®1]),
([æµ‹è¯•æ•°æ®2]),
...;

-- ==========================================
-- 2. æ’å…¥ä¸»è¡¨æ•°æ®
-- ==========================================
DELETE FROM "[ä¸»è¡¨å]" WHERE [æ¡ä»¶];

INSERT INTO "[ä¸»è¡¨å]" ([å­—æ®µåˆ—è¡¨])
VALUES 
([æµ‹è¯•æ•°æ®1]),
([æµ‹è¯•æ•°æ®2]),
...;

-- ==========================================
-- 3. éªŒè¯å…³è”æŸ¥è¯¢
-- ==========================================
SELECT ... FROM "[ä¸»è¡¨]" t
JOIN "[å…³è”è¡¨]" r ON t.[å…³è”å­—æ®µ] = r.[å…³è”å­—æ®µ]
WHERE ...;
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å…³è”å­—æ®µä¸€è‡´æ€§**: ç¡®ä¿ä¸»è¡¨å’Œå…³è”è¡¨çš„å…³è”å­—æ®µå€¼åŒ¹é…
2. **æ•°æ®ä¾èµ–é¡ºåº**: å…ˆæ’å…¥å…³è”è¡¨æ•°æ®ï¼Œå†æ’å…¥ä¸»è¡¨æ•°æ®
3. **æµ‹è¯•åœºæ™¯å®Œæ•´æ€§**: æ¯ä¸ªæµ‹è¯•åœºæ™¯éƒ½è¦æœ‰å®Œæ•´çš„å…³è”æ•°æ®
4. **è·¨åº“æŸ¥è¯¢**: FDW é…ç½®æˆ–æœ¬åœ°è¡¨åˆ›å»ºéœ€è¦æå‰å¤„ç†
5. **åºåˆ—é‡ç½®**: æ’å…¥æ•°æ®åè®°å¾—é‡ç½®åºåˆ—
6. **æ¸…ç†æ—§æ•°æ®**: æµ‹è¯•å‰å…ˆæ¸…ç†æ—§çš„æµ‹è¯•æ•°æ®ï¼Œé¿å…å†²çª

---

## âœ… éªŒè¯æ–¹æ³•

æ¯ä¸ªä¿®å¤åï¼Œæ‰§è¡Œä»¥ä¸‹éªŒè¯ï¼š

```sql
-- 1. éªŒè¯å…³è”æ•°æ®å­˜åœ¨
SELECT COUNT(*) FROM [å…³è”è¡¨] WHERE [æµ‹è¯•æ•°æ®æ¡ä»¶];

-- 2. éªŒè¯å…³è”æŸ¥è¯¢æˆåŠŸ
SELECT ... FROM [ä¸»è¡¨] t
JOIN [å…³è”è¡¨] r ON ...
WHERE [æµ‹è¯•æ•°æ®æ¡ä»¶];

-- 3. éªŒè¯æµ‹è¯•Controlleræ–¹æ³•
-- é€šè¿‡ Postman è°ƒç”¨å¯¹åº”çš„æµ‹è¯•æ¥å£
```

---

## ğŸ¯ ä¿®å¤è¿›åº¦æ€»ç»“

### âœ… å·²å®Œæˆï¼ˆ4/11ï¼‰
1. âœ… **EventScenarioQueue** - 2026-01-26 å®Œæˆ
2. âœ… **SecurityEvent** - 2026-01-26 å®Œæˆï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
3. âœ… **RiskIncident** - 2026-01-26 å®Œæˆï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
4. âœ… **ProhibitHistory** - 2026-01-26 å®Œæˆï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

### ğŸŸ¡ å¾…ä¿®å¤ï¼ˆ7/11ï¼‰
5. â¬œ **OutGoingConfig** - ä¸­ä¼˜å…ˆçº§ï¼Œå¤æ‚åº¦è¾ƒé«˜
6. â¬œ **NoticeHistory** - ä¸­ä¼˜å…ˆçº§ï¼Œç®€å•
7. â¬œ **StrategyDeviceRel** - ä¸­ä¼˜å…ˆçº§ï¼Œç®€å•
8. â¬œ **RiskIncidentOutGoing** - ä½ä¼˜å…ˆçº§
9. â¬œ **RiskIncidentOutGoingHistory** - ä½ä¼˜å…ˆçº§
10. â¬œ **VulAnalysisSub** - è·¨åº“æŸ¥è¯¢ï¼ˆéœ€è¦FDWé…ç½®ï¼‰
11. â¬œ **SecurityZoneSync** - è·¨åº“æŸ¥è¯¢ï¼ˆéœ€è¦FDWé…ç½®ï¼‰

### ğŸ“Š å®Œæˆç‡
- **é«˜ä¼˜å…ˆçº§**: 4/4 (100%) âœ…
- **ä¸­ä¼˜å…ˆçº§**: 0/3 (0%)
- **ä½ä¼˜å…ˆçº§**: 0/2 (0%)
- **è·¨åº“æŸ¥è¯¢**: 0/2 (0%)
- **æ€»ä½“è¿›åº¦**: 4/11 (36.4%)

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

**é€‰é¡¹Aï¼šç»§ç»­ä¿®å¤ä¸­ä¼˜å…ˆçº§æ¨¡å—**
- OutGoingConfig (å¤æ‚ï¼Œéœ€è¦3ä¸ªå¤–å‘é…ç½®è¡¨)
- NoticeHistory (ç®€å•ï¼Œåªéœ€t_linked_strategy)
- StrategyDeviceRel (ç®€å•ï¼Œåªéœ€t_linked_strategy)

**é€‰é¡¹Bï¼šä¿®å¤ä½ä¼˜å…ˆçº§æ¨¡å—**
- RiskIncidentOutGoing å’Œ RiskIncidentOutGoingHistory (éƒ½éœ€è¦ t_risk_incidents)

**é€‰é¡¹Cï¼šå¤„ç†è·¨åº“æŸ¥è¯¢æ¨¡å—**
- éœ€è¦å…ˆé…ç½®FDWæˆ–åˆ›å»ºæœ¬åœ°è¡¨

---

**æŠ¥å‘Šå®Œæˆï¼** é«˜ä¼˜å…ˆçº§æ¨¡å—å·²å…¨éƒ¨ä¿®å¤å®Œæˆï¼ğŸ‰
