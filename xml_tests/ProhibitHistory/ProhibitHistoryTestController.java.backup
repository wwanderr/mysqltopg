package com.test.controller;

import com.dbapp.extension.xdr.linkageHandle.mapper.ProhibitHistoryMapper;
import com.dbapp.extension.xdr.linkageHandle.entity.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.*;

@RestController
@RequestMapping("/test/prohibitHistory")
public class ProhibitHistoryTestController {
    @Autowired
    private ProhibitHistoryMapper mapper;

    @GetMapping("/sumLaunchTimesByStrategyId")
    public String test01() {
        List<BaseHistoryVO> result = mapper.sumLaunchTimesByStrategyId(Arrays.asList(1001, 1002));
        return "SUCCESS: " + result.size();
    }

    @GetMapping("/insertProhibitHistory")
    public String test02() {
        ProhibitHistory history = new ProhibitHistory();
        history.setBlockIp("10.0.0.1");
        history.setLinkDeviceIp("192.168.1.1");
        int rows = mapper.insertProhibitHistory(history);
        return "SUCCESS: " + rows;
    }

    @GetMapping("/updateByBlockipAndDeviceIp")
    public String test03() {
        ProhibitHistory history = new ProhibitHistory();
        history.setBlockIp("10.0.0.1");
        history.setLinkDeviceIp("192.168.1.1");
        mapper.updateByBlockipAndDeviceIp(history);
        return "SUCCESS";
    }

    @GetMapping("/updateStatusById")
    public String test04() {
        ProhibitHistory history = new ProhibitHistory();
        history.setId(1L);
        history.setStatus(false);
        mapper.updateStatusById(history);
        return "SUCCESS";
    }

    @GetMapping("/deleteByIds")
    public String test05() {
        int rows = mapper.deleteByIds(Arrays.asList(1L, 2L));
        return "SUCCESS: " + rows;
    }

    @GetMapping("/getProhibitListByCondition")
    public String test06() {
        ProhibitHistoryParam param = new ProhibitHistoryParam();
        List<ProhibitHistoryVO> result = mapper.getProhibitListByCondition(param);
        return "SUCCESS: " + result.size();
    }

    @GetMapping("/listByCondition")
    public String test07() {
        ProhibitHistoryParam param = new ProhibitHistoryParam();
        List<ProhibitHistoryVO> result = mapper.listByCondition(param);
        return "SUCCESS: " + result.size();
    }

    @GetMapping("/getProhibitListCount")
    public String test08() {
        ProhibitHistoryParam param = new ProhibitHistoryParam();
        Long count = mapper.getProhibitListCount(param);
        return "SUCCESS: " + count;
    }

    @GetMapping("/getBlockIPDistribution")
    public String test09() {
        String now = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        String yesterday = LocalDateTime.now().minusDays(1).format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        List<BlockIPDistribution> result = mapper.getBlockIPDistribution(yesterday, now);
        return "SUCCESS: " + result.size();
    }

    @GetMapping("/getTrend")
    public String test10() {
        String now = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        String lastWeek = LocalDateTime.now().minusDays(7).format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        List<BlockIPTrend> result = mapper.getTrend(lastWeek, now);
        return "SUCCESS: " + result.size();
    }

    @GetMapping("/getBlockIPCount")
    public String test11() {
        String now = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        String lastWeek = LocalDateTime.now().minusDays(7).format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        Long count = mapper.getBlockIPCount(lastWeek, now);
        return "SUCCESS: " + count;
    }

    @GetMapping("/getBlockIPTodayCount")
    public String test12() {
        Long count = mapper.getBlockIPTodayCount();
        return "SUCCESS: " + count;
    }

    @GetMapping("/getAutoBlockIPCount")
    public String test13() {
        String now = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        String lastWeek = LocalDateTime.now().minusDays(7).format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        Long count = mapper.getAutoBlockIPCount(lastWeek, now);
        return "SUCCESS: " + count;
    }

    @GetMapping("/getAutoBlockIPTodayCount")
    public String test14() {
        Long count = mapper.getAutoBlockIPTodayCount();
        return "SUCCESS: " + count;
    }

    @GetMapping("/getTriggerSubscriptionCount")
    public String test15() {
        String now = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        String lastWeek = LocalDateTime.now().minusDays(7).format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        Long count = mapper.getTriggerSubscriptionCount(lastWeek, now);
        return "SUCCESS: " + count;
    }

    @GetMapping("/getStrategyCount")
    public String test16() {
        String now = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        String lastWeek = LocalDateTime.now().minusDays(7).format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        Long count = mapper.getStrategyCount(lastWeek, now);
        return "SUCCESS: " + count;
    }

    @GetMapping("/getProhibitListByDeviceId")
    public String test17() {
        List<ProhibitHistoryVO> result = mapper.getProhibitListByDeviceId("device-001", "192.168.1.1");
        return "SUCCESS: " + result.size();
    }

    @GetMapping("/getPairHistories")
    public String test18() {
        Map<String, Object> params = new HashMap<>();
        List<ProhibitHistoryVO> result = mapper.getPairHistories(params);
        return "SUCCESS: " + result.size();
    }

    @GetMapping("/getSingleHistories")
    public String test19() {
        Map<String, Object> params = new HashMap<>();
        List<ProhibitHistoryVO> result = mapper.getSingleHistories(params);
        return "SUCCESS: " + result.size();
    }
}
