# å¾…ç¡®è®¤é—®é¢˜æ¸…å•

## ğŸ“‹ é—®é¢˜æ±‡æ€»

æ ¹æ®ä½ çš„è¦æ±‚ï¼Œæˆ‘å·²ç»æ£€æŸ¥å®Œæˆï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

---

## ğŸ”´ é—®é¢˜1: DDLæ–‡ä»¶ä¸­çš„ `xdr22.` æ¨¡å¼åå‰ç¼€

### åŸºæœ¬ä¿¡æ¯
- **å½±å“èŒƒå›´**: 53ä¸ªDDLæ–‡ä»¶
- **æ€»å‡ºç°æ¬¡æ•°**: 62å¤„
- **é—®é¢˜ç±»å‹**: æ¨¡å¼åå‰ç¼€éœ€è¦åˆ é™¤

### å…¸å‹ç¤ºä¾‹

**æ–‡ä»¶**: `V20260122133659038__create_t_scan_history.sql` (ç¬¬88-90è¡Œ)

```sql
-- âŒ å½“å‰ï¼ˆé”™è¯¯ï¼‰
"virus_status" "t_scan_history_virus_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::xdr22.t_scan_history_virus_status,
"site_status" "t_scan_history_site_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::xdr22.t_scan_history_site_status,
"vulnerability_status" "t_scan_history_vulnerability_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::xdr22.t_scan_history_vulnerability_status,
```

```sql
-- âœ… åº”è¯¥æ”¹ä¸º
"virus_status" "t_scan_history_virus_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::t_scan_history_virus_status,
"site_status" "t_scan_history_site_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::t_scan_history_site_status,
"vulnerability_status" "t_scan_history_vulnerability_status" NOT NULL 
    DEFAULT 'æ— ä¸‹å‘è®°å½•'::t_scan_history_vulnerability_status,
```

### ä¿®å¤æ–¹æ¡ˆ
æ‰¹é‡æ›¿æ¢æ‰€æœ‰DDLæ–‡ä»¶ä¸­çš„ `xdr22.` â†’ ç©ºå­—ç¬¦ä¸²

---

## ğŸ”´ é—®é¢˜2: SecurityTypeMapper.xml - is_enableå­—æ®µ

### åŸºæœ¬ä¿¡æ¯
- **æ–‡ä»¶**: `postgresql_xml_manual/SecurityTypeMapper.xml`
- **é—®é¢˜**: BOOLEANå­—æ®µä½¿ç”¨INTEGERç±»å‹
- **ä½ç½®**: ç¬¬31è¡Œ

### DDLå®šä¹‰
```sql
-- t_security_typesè¡¨
"is_enable" bool NOT NULL DEFAULT false
```

### XMLå½“å‰å†™æ³•
```xml
<!-- âŒ ç¬¬31è¡Œï¼ˆé”™è¯¯ï¼‰ -->
<insert id="branchInsert">
    INSERT INTO t_security_types ("mirror_sub_category","mirror_category",
        "sub_category_name","category_name","is_enable")
    VALUES
    <foreach collection="list" item="securityTypes" separator=",">
        (#{securityTypes.mirrorSubCategory,jdbcType=VARCHAR},
         #{securityTypes.mirrorCategory,jdbcType=VARCHAR},
         #{securityTypes.subCategoryName,jdbcType=VARCHAR},
         #{securityTypes.categoryName,jdbcType=VARCHAR},
         #{securityTypes.isEnable,jdbcType=INTEGER})
    </foreach>
</insert>
```

### ä¿®å¤æ–¹æ¡ˆ
```xml
<!-- âœ… åº”è¯¥æ”¹ä¸º -->
(#{securityTypes.isEnable,jdbcType=INTEGER}::int)::boolean
```

---

## ğŸŸ¡ é—®é¢˜3: EventTemplateMapper.xml - enableå­—æ®µ

### åŸºæœ¬ä¿¡æ¯
- **æ–‡ä»¶**: `postgresql_xml_manual/EventTemplateMapper.xml`
- **çŠ¶æ€**: âœ… **å·²ç»ä¿®å¤è¿‡äº†ï¼**
- **å½“å‰æ ¼å¼**: `(#{enable,jdbcType=INTEGER}::int)::boolean`

### å½“å‰çŠ¶æ€ï¼ˆå·²ä¿®å¤ï¼‰
```xml
<!-- âœ… ç¬¬14è¡Œ - batchInsert -->
(#{eventList.enable,jdbcType=INTEGER}::int)::boolean

<!-- âœ… ç¬¬83è¡Œ - updateByUniqCode -->
(#{enable,jdbcType=INTEGER}::int)::boolean

<!-- âœ… ç¬¬100è¡Œ - updateByIncidentName -->
enable = (#{enable,jdbcType=INTEGER}::int)::boolean
```

### ç»“è®º
**æ— éœ€ä¿®å¤** - è¯¥æ–‡ä»¶çš„ `enable` å­—æ®µå·²ç»æ­£ç¡®å¤„ç† âœ…

---

## ğŸ”´ é—®é¢˜4: SecurityAlarmHandleMapper.xml - resultå­—æ®µ

### åŸºæœ¬ä¿¡æ¯
- **æ–‡ä»¶**: `postgresql_xml_manual/SecurityAlarmHandleMapper.xml`
- **é—®é¢˜**: BOOLEANå­—æ®µä½¿ç”¨INTEGERç±»å‹
- **ä½ç½®**: ç¬¬19è¡Œã€ç¬¬26è¡Œ

### DDLå®šä¹‰
```sql
-- t_security_alarm_handleè¡¨
"result" bool
```

### XMLå½“å‰å†™æ³•

**ä½ç½®1: insertOrUpdate (ç¬¬19è¡Œ)**
```xml
<!-- âŒ é”™è¯¯ -->
<insert id="insertOrUpdate">
    INSERT INTO t_security_alarm_handle
    (agg_condition, window_id, execute_time, handle_status, "result")
    VALUES
    <foreach collection="handleList" item="item" separator=",">
        (#{item.aggCondition,jdbcType=VARCHAR},
         #{item.windowId,jdbcType=VARCHAR},
         CAST(#{item.executeTime} AS timestamp),
         #{item.handleStatus,jdbcType=VARCHAR},
         #{item.result,jdbcType=INTEGER})
    </foreach>
</insert>
```

**ä½ç½®2: updateStatusById (ç¬¬26è¡Œ)**
```xml
<!-- âŒ é”™è¯¯ -->
<update id="updateStatusById">
    UPDATE t_security_alarm_handle 
    SET "result" = #{securityAlarmHandle.result,jdbcType=INTEGER} 
    WHERE id = #{securityAlarmHandle.id}
</update>
```

### ä¿®å¤æ–¹æ¡ˆ

**ä½ç½®1ä¿®å¤**:
```xml
<!-- âœ… åº”è¯¥æ”¹ä¸º -->
(#{item.result,jdbcType=INTEGER}::int)::boolean
```

**ä½ç½®2ä¿®å¤**:
```xml
<!-- âœ… åº”è¯¥æ”¹ä¸º -->
SET "result" = (#{securityAlarmHandle.result,jdbcType=INTEGER}::int)::boolean
```

---

## ğŸ“Š é—®é¢˜ç»Ÿè®¡è¡¨

| åºå· | é—®é¢˜ç±»å‹ | æ–‡ä»¶/èŒƒå›´ | ä½ç½® | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|---------|----------|------|------|--------|
| 1 | `xdr22.` æ¨¡å¼åå‰ç¼€ | 53ä¸ªDDLæ–‡ä»¶ | 62å¤„ | â³ å¾…ä¿®å¤ | ğŸ”´ é«˜ |
| 2 | BOOLEAN vs INTEGER | SecurityTypeMapper.xml | ç¬¬31è¡Œ | â³ å¾…ä¿®å¤ | ğŸ”´ é«˜ |
| 3 | BOOLEAN vs INTEGER | EventTemplateMapper.xml | - | âœ… å·²ä¿®å¤ | - |
| 4 | BOOLEAN vs INTEGER | SecurityAlarmHandleMapper.xml | ç¬¬19, 26è¡Œ | â³ å¾…ä¿®å¤ | ğŸ”´ é«˜ |

---

## ğŸ¯ è¯¦ç»†ä¿®å¤æ¸…å•

### éœ€è¦ä¿®å¤çš„é—®é¢˜ï¼ˆ3ä¸ªï¼‰

#### âœ… é—®é¢˜1: åˆ é™¤ xdr22. å‰ç¼€
- **æ–‡ä»¶æ•°**: 53ä¸ªDDL
- **ä¿®æ”¹å¤„æ•°**: 62å¤„
- **ä¿®å¤æ–¹å¼**: æ‰¹é‡æ›¿æ¢ `xdr22.` â†’ ``

#### âœ… é—®é¢˜2: SecurityTypeMapper.xml
- **æ–‡ä»¶**: `postgresql_xml_manual/SecurityTypeMapper.xml`
- **å­—æ®µ**: `is_enable`
- **ä¿®æ”¹å¤„æ•°**: 1å¤„ï¼ˆç¬¬31è¡Œï¼‰
- **ä¿®å¤æ–¹å¼**: 
  ```xml
  #{securityTypes.isEnable,jdbcType=INTEGER}
  æ”¹ä¸º
  (#{securityTypes.isEnable,jdbcType=INTEGER}::int)::boolean
  ```

#### âœ… é—®é¢˜4: SecurityAlarmHandleMapper.xml
- **æ–‡ä»¶**: `postgresql_xml_manual/SecurityAlarmHandleMapper.xml`
- **å­—æ®µ**: `result`
- **ä¿®æ”¹å¤„æ•°**: 2å¤„ï¼ˆç¬¬19è¡Œã€ç¬¬26è¡Œï¼‰
- **ä¿®å¤æ–¹å¼**:
  ```xml
  #{item.result,jdbcType=INTEGER}
  æ”¹ä¸º
  (#{item.result,jdbcType=INTEGER}::int)::boolean
  
  #{securityAlarmHandle.result,jdbcType=INTEGER}
  æ”¹ä¸º
  (#{securityAlarmHandle.result,jdbcType=INTEGER}::int)::boolean
  ```

---

## âœ… å·²ç»ä¿®å¤çš„é—®é¢˜ï¼ˆ1ä¸ªï¼‰

#### âœ… EventTemplateMapper.xml - enableå­—æ®µ
- **çŠ¶æ€**: å·²ä¿®å¤ âœ…
- **å½“å‰æ ¼å¼**: `(#{enable,jdbcType=INTEGER}::int)::boolean`
- **æ— éœ€å†æ¬¡ä¿®å¤**

---

## ğŸ” å…¶ä»–æ£€æŸ¥ç»“æœ

### âœ… æ—¶é—´å­—æ®µ
- **çŠ¶æ€**: å…¨éƒ¨å·²ä¿®å¤
- **æ ¼å¼**: `CAST(#{field} AS timestamp)`
- **éªŒè¯**: 80ä¸ªXMLæ–‡ä»¶ï¼Œ100%é€šè¿‡

### âœ… è¡¨åé‡å¤
- **çŠ¶æ€**: æ— é‡å¤
- **éªŒè¯**: 53ä¸ªè¡¨ï¼Œå…¨éƒ¨å”¯ä¸€

### âœ… Flywayæ–‡ä»¶å
- **çŠ¶æ€**: ç¬¦åˆè§„èŒƒ
- **æ ¼å¼**: `V20260122133659001__create_table_name.sql`

### âœ… DROP SEQUENCE CASCADE
- **çŠ¶æ€**: å·²æ·»åŠ 
- **éªŒè¯**: 46ä¸ªåºåˆ—ï¼Œå…¨éƒ¨åŒ…å«CASCADE

### âœ… æ—¶é—´æˆ³æ“ä½œç¬¦ç±»
- **çŠ¶æ€**: å·²ä¿®å¤
- **éªŒè¯**: æ—  `timestamptz_ops` æ®‹ç•™

---

## ğŸ“ å¾…ç¡®è®¤äº‹é¡¹

### è¯·ç¡®è®¤ä»¥ä¸‹é—®é¢˜ï¼š

1. **xdr22æ¨¡å¼å**
   - â“ ç¡®è®¤åˆ é™¤ `xdr22.` å‰ç¼€ï¼Ÿ
   - â“ è¿˜æ˜¯æ”¹ä¸º `public.` æˆ–å…¶ä»–æ¨¡å¼åï¼Ÿ
   - ğŸ‘‰ **æˆ‘çš„å»ºè®®**: ç›´æ¥åˆ é™¤ï¼Œä½¿ç”¨é»˜è®¤æ¨¡å¼

2. **BOOLEANå­—æ®µè½¬æ¢æ ¼å¼**
   - â“ ä½¿ç”¨ `(#{field}::int)::boolean` æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Ÿ
   - ğŸ‘‰ **æˆ‘çš„å»ºè®®**: è¿™æ˜¯æ ‡å‡†æ ¼å¼ï¼Œå·²åœ¨EventTemplateMapperä¸­éªŒè¯

3. **æ˜¯å¦è¿˜æœ‰å…¶ä»–é—®é¢˜**
   - â“ é™¤äº†ä¸Šè¿°3ä¸ªå¾…ä¿®å¤é—®é¢˜å¤–ï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–éœ€è¦æ£€æŸ¥çš„ï¼Ÿ
   - ğŸ‘‰ **æˆ‘çš„å»ºè®®**: å…ˆä¿®å¤è¿™3ä¸ªï¼Œç„¶åæ‰§è¡ŒFlywayæµ‹è¯•

---

## ğŸš€ å»ºè®®çš„ä¿®å¤é¡ºåº

1. âœ… **ç¬¬ä¸€æ­¥**: ä¿®å¤é—®é¢˜1 (xdr22.å‰ç¼€) - æ‰¹é‡æ“ä½œï¼Œå½±å“æœ€å¤§
2. âœ… **ç¬¬äºŒæ­¥**: ä¿®å¤é—®é¢˜2 (SecurityTypeMapper.xml) - 1å¤„ä¿®æ”¹
3. âœ… **ç¬¬ä¸‰æ­¥**: ä¿®å¤é—®é¢˜4 (SecurityAlarmHandleMapper.xml) - 2å¤„ä¿®æ”¹
4. âœ… **ç¬¬å››æ­¥**: æ‰§è¡ŒFlywayè¿ç§»æµ‹è¯•
5. âœ… **ç¬¬äº”æ­¥**: ä½¿ç”¨Postmanæµ‹è¯•æ¥å£

---

## ğŸ“‹ ä¿®å¤åçš„éªŒè¯

### DDLéªŒè¯
```bash
# éªŒè¯ xdr22. å·²å…¨éƒ¨åˆ é™¤
grep -r "xdr22\." create_table/migrations_ultimate/
# åº”è¯¥è¿”å›: æ— åŒ¹é…
```

### XMLéªŒè¯
```bash
# éªŒè¯BOOLEANå­—æ®µè½¬æ¢
grep -r "jdbcType=INTEGER" postgresql_xml_manual/ | grep -E "(is_enable|enable|result)"
# åº”è¯¥å…¨éƒ¨åŒ…å« ::int)::boolean
```

### æ•°æ®åº“éªŒè¯
```sql
-- æµ‹è¯•æ’å…¥æ•°æ®
INSERT INTO t_security_types (is_enable) VALUES (1);
INSERT INTO t_security_alarm_handle (result) VALUES (0);
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-22  
**å¾…ä¿®å¤é—®é¢˜æ•°**: 3ä¸ª  
**å·²ä¿®å¤é—®é¢˜æ•°**: 1ä¸ª  
**çŠ¶æ€**: â³ ç­‰å¾…ç¡®è®¤åå¼€å§‹ä¿®å¤
