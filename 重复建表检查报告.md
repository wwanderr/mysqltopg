# é‡å¤å»ºè¡¨æ£€æŸ¥æŠ¥å‘Š

## âœ… æ£€æŸ¥ç»“è®º

**æ— é‡å¤å»ºè¡¨è¯­å¥ï¼å¯ä»¥å®‰å…¨æ‰§è¡ŒFlywayè¿ç§»ï¼**

---

## ğŸ“Š æ£€æŸ¥ç»“æœ

| é¡¹ç›® | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| **SQLæ–‡ä»¶æ•°** | 53ä¸ª | æ‰€æœ‰Flywayè¿ç§»è„šæœ¬ |
| **CREATE TABLEè¯­å¥** | 53ä¸ª | æ¯ä¸ªæ–‡ä»¶1ä¸ª |
| **å”¯ä¸€è¡¨åæ•°** | 53ä¸ª | æ‰€æœ‰è¡¨åå”¯ä¸€ |
| **é‡å¤è¡¨** | 0ä¸ª | âœ… æ— é‡å¤ |

---

## ğŸ“‹ å®Œæ•´è¡¨æ¸…å•ï¼ˆ53ä¸ªè¡¨ï¼‰

æŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼š

| åºå· | è¡¨å | å¯¹åº”æ–‡ä»¶ |
|------|------|---------|
| 1 | `t_alarm_out_going_config` | V20260122133659001__create_t_alarm_out_going_config.sql |
| 2 | `t_alarm_status_timing_task` | V20260122133659002__create_t_alarm_status_timing_task.sql |
| 3 | `t_atip_config` | V20260122133659003__create_t_atip_config.sql |
| 4 | `t_attack_knowledge` | V20260122133659004__create_t_attack_knowledge.sql |
| 5 | `t_attacker_traffic_task` | V20260122133659005__create_t_attacker_traffic_task.sql |
| 6 | `t_block_history` | V20260122133659006__create_t_block_history.sql |
| 7 | `t_chart_template` | V20260122133659007__create_t_chart_template.sql |
| 8 | `t_common_config` | V20260122133659008__create_t_common_config.sql |
| 9 | `t_event_out_going_config` | V20260122133659009__create_t_event_out_going_config.sql |
| 10 | `t_event_out_going_data` | V20260122133659010__create_t_event_out_going_data.sql |
| 11 | `t_event_scenario_data` | V20260122133659011__create_t_event_scenario_data.sql |
| 12 | `t_event_scenario_queue` | V20260122133659012__create_t_event_scenario_queue.sql |
| 13 | `t_event_scenario_template` | V20260122133659013__create_t_event_scenario_template.sql |
| 14 | `t_event_template` | V20260122133659014__create_t_event_template.sql |
| 15 | `t_event_thread` | V20260122133659015__create_t_event_thread.sql |
| 16 | `t_event_update_ck_alarm_queue` | V20260122133659016__create_t_event_update_ck_alarm_queue.sql |
| 17 | `t_intelligence_sub` | V20260122133659017__create_t_intelligence_sub.sql |
| 18 | `t_intelligence_sub_asset` | V20260122133659018__create_t_intelligence_sub_asset.sql |
| 19 | `t_isolation_history` | V20260122133659019__create_t_isolation_history.sql |
| 20 | `t_linkage_strategy_validtime` | V20260122133659020__create_t_linkage_strategy_validtime.sql |
| 21 | `t_linked_strategy` | V20260122133659021__create_t_linked_strategy.sql |
| 22 | `t_linked_strategy_template` | V20260122133659022__create_t_linked_strategy_template.sql |
| 23 | `t_log_correlation_job` | V20260122133659023__create_t_log_correlation_job.sql |
| 24 | `t_notice_history` | V20260122133659024__create_t_notice_history.sql |
| 25 | `t_out_going_config` | V20260122133659025__create_t_out_going_config.sql |
| 26 | `t_process_chain` | V20260122133659026__create_t_process_chain.sql |
| 27 | `t_process_chain_history` | V20260122133659027__create_t_process_chain_history.sql |
| 28 | `t_process_kill_history` | V20260122133659028__create_t_process_kill_history.sql |
| 29 | `t_prohibit_domain_history` | V20260122133659029__create_t_prohibit_domain_history.sql |
| 30 | `t_prohibit_history` | V20260122133659030__create_t_prohibit_history.sql |
| 31 | `t_query_template` | V20260122133659031__create_t_query_template.sql |
| 32 | `t_risk_incidents` | V20260122133659032__create_t_risk_incidents.sql |
| 33 | `t_risk_incidents_analysis` | V20260122133659033__create_t_risk_incidents_analysis.sql |
| 34 | `t_risk_incidents_history` | V20260122133659034__create_t_risk_incidents_history.sql |
| 35 | `t_risk_incidents_out_going` | V20260122133659035__create_t_risk_incidents_out_going.sql |
| 36 | `t_risk_incidents_out_going_history` | V20260122133659036__create_t_risk_incidents_out_going_history.sql |
| 37 | `t_risk_out_going_config` | V20260122133659037__create_t_risk_out_going_config.sql |
| 38 | `t_scan_history` | V20260122133659038__create_t_scan_history.sql |
| 39 | `t_scan_history_detail` | V20260122133659039__create_t_scan_history_detail.sql |
| 40 | `t_scan_job` | V20260122133659040__create_t_scan_job.sql |
| 41 | `t_scene_login_baseline` | V20260122133659041__create_t_scene_login_baseline.sql |
| 42 | `t_scene_rule_config` | V20260122133659042__create_t_scene_rule_config.sql |
| 43 | `t_scene_rule_info` | V20260122133659043__create_t_scene_rule_info.sql |
| 44 | `t_scene_web_access_temp` | V20260122133659044__create_t_scene_web_access_temp.sql |
| 45 | `t_security_alarm_handle` | V20260122133659045__create_t_security_alarm_handle.sql |
| 46 | `t_security_alarm_temp` | V20260122133659046__create_t_security_alarm_temp.sql |
| 47 | `t_security_incidents` | V20260122133659047__create_t_security_incidents.sql |
| 48 | `t_security_types` | V20260122133659048__create_t_security_types.sql |
| 49 | `t_strategy_device_rel` | V20260122133659049__create_t_strategy_device_rel.sql |
| 50 | `t_tag_search_list` | V20260122133659050__create_t_tag_search_list.sql |
| 51 | `t_virus_kill_history` | V20260122133659051__create_t_virus_kill_history.sql |
| 52 | `t_vul_analysis_sub` | V20260122133659052__create_t_vul_analysis_sub.sql |
| 53 | `xdr_schema_version` | V20260122133659053__create_xdr_schema_version.sql |

---

## âœ… éªŒè¯è¦ç‚¹

### 1. æ–‡ä»¶ä¸è¡¨ä¸€ä¸€å¯¹åº”

- âœ… æ¯ä¸ªæ–‡ä»¶åˆ›å»º **1ä¸ªè¡¨**
- âœ… æ¯ä¸ªè¡¨åªåœ¨ **1ä¸ªæ–‡ä»¶**ä¸­å®šä¹‰
- âœ… æ–‡ä»¶åä¸è¡¨åå¯¹åº”å…³ç³»æ¸…æ™°

### 2. æ— è¡¨åå†²çª

- âœ… 53ä¸ªè¡¨åå…¨éƒ¨å”¯ä¸€
- âœ… ä¸å­˜åœ¨åŒä¸€ä¸ªè¡¨è¢«å¤šæ¬¡åˆ›å»ºçš„æƒ…å†µ
- âœ… Flywayæ‰§è¡Œä¸ä¼šæœ‰è¡¨åå†²çª

### 3. å‘½åè§„èŒƒç»Ÿä¸€

- âœ… 52ä¸ªä¸šåŠ¡è¡¨ä½¿ç”¨ `t_` å‰ç¼€
- âœ… 1ä¸ªç³»ç»Ÿè¡¨: `xdr_schema_version` (Flywayç‰ˆæœ¬è¡¨)
- âœ… è¡¨åä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼ˆsnake_caseï¼‰

---

## ğŸ“Š è¡¨åˆ†ç±»ç»Ÿè®¡

### æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç±»

| æ¨¡å— | è¡¨æ•°é‡ | ç¤ºä¾‹è¡¨ |
|------|--------|--------|
| **å‘Šè­¦ç›¸å…³** | 4ä¸ª | `t_alarm_out_going_config`, `t_alarm_status_timing_task` |
| **äº‹ä»¶ç›¸å…³** | 10ä¸ª | `t_event_out_going_data`, `t_event_template`, `t_event_scenario_queue` |
| **é£é™©äº‹ä»¶** | 6ä¸ª | `t_risk_incidents`, `t_risk_incidents_history`, `t_risk_out_going_config` |
| **æƒ…æŠ¥ç›¸å…³** | 2ä¸ª | `t_intelligence_sub`, `t_intelligence_sub_asset` |
| **æ‰«æç›¸å…³** | 3ä¸ª | `t_scan_history`, `t_scan_history_detail`, `t_scan_job` |
| **å®‰å…¨äº‹ä»¶** | 5ä¸ª | `t_security_incidents`, `t_security_alarm_handle`, `t_security_types` |
| **åœºæ™¯è§„åˆ™** | 5ä¸ª | `t_scene_login_baseline`, `t_scene_rule_config`, `t_scene_web_access_temp` |
| **è”åŠ¨ç­–ç•¥** | 4ä¸ª | `t_linked_strategy`, `t_linkage_strategy_validtime`, `t_notice_history` |
| **è¿›ç¨‹é“¾ç›¸å…³** | 3ä¸ª | `t_process_chain`, `t_process_chain_history`, `t_process_kill_history` |
| **é˜»æ–­ç›¸å…³** | 3ä¸ª | `t_block_history`, `t_prohibit_history`, `t_isolation_history` |
| **å¤–å‘é…ç½®** | 2ä¸ª | `t_out_going_config`, `t_event_out_going_config` |
| **å…¶ä»–** | 6ä¸ª | `t_common_config`, `t_chart_template`, `t_attack_knowledge` ç­‰ |

---

## ğŸ¯ Flywayè¿ç§»é¡ºåº

### æ‰§è¡Œé¡ºåº

Flywayå°†æŒ‰ç‰ˆæœ¬å·é¡ºåºæ‰§è¡Œï¼š

```
V20260122133659001 â†’ V20260122133659002 â†’ ... â†’ V20260122133659053
```

### æ¯ä¸ªç‰ˆæœ¬

- âœ… åˆ›å»º **1ä¸ªè¡¨**
- âœ… åŒ…å«å®Œæ•´DDLï¼ˆåºåˆ—ã€è¡¨ã€ç´¢å¼•ã€ä¸»é”®ã€è§¦å‘å™¨ï¼‰
- âœ… å¸¦æœ‰ `DROP ... IF EXISTS CASCADE` è¯­å¥
- âœ… å¯ä»¥é‡å¤æ‰§è¡Œï¼ˆå¹‚ç­‰æ€§ï¼‰

---

## ğŸ” æ£€æŸ¥æ–¹æ³•

ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ‰«ææ‰€æœ‰SQLæ–‡ä»¶ï¼š

```python
# æå–æ‰€æœ‰ CREATE TABLE è¯­å¥
pattern = r'CREATE TABLE\s+"([^"]+)"'

# ç»“æœ
- æ‰¾åˆ° 53 ä¸ª CREATE TABLE è¯­å¥
- æå–å‡º 53 ä¸ªå”¯ä¸€è¡¨å
- æ— é‡å¤
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… å½“å‰è®¾è®¡ç¬¦åˆæœ€ä½³å®è·µ

1. **ä¸€æ–‡ä»¶ä¸€è¡¨** - ä¾¿äºç»´æŠ¤å’Œç®¡ç†
2. **å”¯ä¸€è¡¨å** - é¿å…å†²çª
3. **æ¸…æ™°å‘½å** - è¡¨åä¸æ–‡ä»¶åå¯¹åº”
4. **å®Œæ•´DDL** - æ¯ä¸ªæ–‡ä»¶åŒ…å«å®Œæ•´çš„è¡¨å®šä¹‰

### å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å½“å‰ |
|------|------|------|------|
| ä¸€æ–‡ä»¶ä¸€è¡¨ | æ¸…æ™°ã€æ˜“ç»´æŠ¤ | æ–‡ä»¶æ•°é‡å¤š | âœ… é‡‡ç”¨ |
| å¤šè¡¨ä¸€æ–‡ä»¶ | æ–‡ä»¶æ•°é‡å°‘ | éš¾ä»¥ç®¡ç†ã€å›æ»šå¤æ‚ | âŒ æœªé‡‡ç”¨ |
| æŒ‰æ¨¡å—åˆ†æ–‡ä»¶ | æ¨¡å—åŒ– | ç‰ˆæœ¬ç®¡ç†å¤æ‚ | âŒ æœªé‡‡ç”¨ |

---

## ğŸ‰ æœ€ç»ˆç»“è®º

### âœ… æ£€æŸ¥é€šè¿‡

```
æ£€æŸ¥é¡¹ç›®:
  âœ… æ— é‡å¤è¡¨å®šä¹‰
  âœ… æ¯ä¸ªæ–‡ä»¶åˆ›å»º1ä¸ªè¡¨
  âœ… æ‰€æœ‰è¡¨åå”¯ä¸€
  âœ… æ–‡ä»¶åè§„èŒƒç¬¦åˆFlywayè¦æ±‚
  âœ… DDLè¯­å¥å®Œæ•´
  âœ… å¯ä»¥å®‰å…¨æ‰§è¡Œè¿ç§»

çŠ¶æ€: å®Œå…¨å°±ç»ª âœ…
```

### ğŸš€ ä¸‹ä¸€æ­¥

å¯ä»¥ç›´æ¥æ‰§è¡ŒFlywayè¿ç§»ï¼š

```bash
# 1. éªŒè¯è¿ç§»è„šæœ¬
flyway validate

# 2. æŸ¥çœ‹å¾…æ‰§è¡Œçš„è¿ç§»
flyway info

# 3. æ‰§è¡Œæ•°æ®åº“è¿ç§»
flyway migrate

# 4. ç¡®è®¤ç»“æœ
flyway info
```

---

**æ£€æŸ¥æ—¶é—´**: 2026-01-22  
**æ£€æŸ¥æ–‡ä»¶æ•°**: 53ä¸ª  
**å”¯ä¸€è¡¨æ•°**: 53ä¸ª  
**é‡å¤è¡¨æ•°**: 0ä¸ª  
**çŠ¶æ€**: âœ… é€šè¿‡
