{
  "info": {
    "name": "AlarmOutGoingConfig 测试集合",
    "description": "测试 PostgreSQL XML 转换后的 SQL 语句是否正常工作",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. 测试 delById - 逻辑删除记录",
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "http://localhost:8080/api/test/alarm-outgoing-config/delete/1004",
          "protocol": "http",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "test", "alarm-outgoing-config", "delete", "1004"]
        },
        "description": "测试逻辑删除功能\n\nSQL: UPDATE t_alarm_out_going_config SET IS_DEL = 1 WHERE id = #{alarmOutGoingConfig.id}\n\n测试数据ID: 1004\n\n预期结果：\n- affectedRows = 1\n- 数据库中 id=1004 的记录 is_del 字段变为 1"
      },
      "response": []
    },
    {
      "name": "2. 测试 updateSendStatus - 发送成功场景",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"id\": 1001\n}"
        },
        "url": {
          "raw": "http://localhost:8080/api/test/alarm-outgoing-config/update-status/success",
          "protocol": "http",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "test", "alarm-outgoing-config", "update-status", "success"]
        },
        "description": "测试发送成功时的状态更新\n\nSQL: \nUPDATE t_alarm_out_going_config\nSET last_send_time = CURRENT_TIMESTAMP,\n    send_count = send_count + 1,\n    last_send_result = '成功',\n    cause_of_failure = NULL,\n    succeed_count = succeed_count + 1\nWHERE id = 1001\n\n测试数据ID: 1001\n\n预期结果：\n- affectedRows = 1\n- send_count 增加 1\n- succeed_count 增加 1\n- last_send_result = '成功'\n- last_send_time 更新为当前时间"
      },
      "response": []
    },
    {
      "name": "3. 测试 updateSendStatus - 发送失败场景",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"id\": 1002,\n  \"causeOfFailure\": \"连接超时，无法访问目标服务器\"\n}"
        },
        "url": {
          "raw": "http://localhost:8080/api/test/alarm-outgoing-config/update-status/failure",
          "protocol": "http",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "test", "alarm-outgoing-config", "update-status", "failure"]
        },
        "description": "测试发送失败时的状态更新\n\nSQL: \nUPDATE t_alarm_out_going_config\nSET last_send_time = CURRENT_TIMESTAMP,\n    send_count = send_count + 1,\n    last_send_result = '失败',\n    cause_of_failure = '连接超时，无法访问目标服务器'\nWHERE id = 1002\n\n注意：失败时不会增加 succeed_count（因为 if test 条件不满足）\n\n测试数据ID: 1002\n\n预期结果：\n- affectedRows = 1\n- send_count 增加 1\n- succeed_count 不变\n- last_send_result = '失败'\n- cause_of_failure = '连接超时，无法访问目标服务器'\n- last_send_time 更新为当前时间"
      },
      "response": []
    },
    {
      "name": "4. 完整测试流程",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "http://localhost:8080/api/test/alarm-outgoing-config/full-test/1003",
          "protocol": "http",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "test", "alarm-outgoing-config", "full-test", "1003"]
        },
        "description": "组合测试，依次执行：\n1. 更新发送状态为成功\n2. 更新发送状态为失败\n3. 逻辑删除记录\n\n测试数据ID: 1003\n\n预期结果：\n- 所有步骤都返回 affectedRows = 1\n- 最终 id=1003 的记录被逻辑删除（is_del=1）"
      },
      "response": []
    },
    {
      "name": "5. 验证数据 - 查看测试结果",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "http://localhost:8080/api/test/alarm-outgoing-config/verify",
          "protocol": "http",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "test", "alarm-outgoing-config", "verify"]
        },
        "description": "查询测试数据的当前状态\n\n需要在 Controller 中添加查询方法（可选）"
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "testId1",
      "value": "1001",
      "type": "string"
    },
    {
      "key": "testId2",
      "value": "1002",
      "type": "string"
    },
    {
      "key": "testId3",
      "value": "1003",
      "type": "string"
    },
    {
      "key": "testId4",
      "value": "1004",
      "type": "string"
    }
  ]
}
